module.exports=[84714,a=>{"use strict";var b=a.i(36679),c=a.i(2852),d=a.i(11884);function e({phone:a}){return a?(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)("a",{href:`tel:${a}`,className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors",children:["Call ",a]}),(0,b.jsx)("button",{onClick:()=>{a&&(navigator.clipboard.writeText(a),alert("Phone number copied to clipboard"))},className:"px-4 py-2 bg-[#0A1A2F] border border-white/5 hover:border-[#32CE7A]/40 text-white font-semibold rounded-lg transition-colors",children:"Copy Phone"})]}):null}function f({address:a,latitude:c,longitude:d,city:e,province:f}){return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Location"}),(0,b.jsxs)("div",{className:"text-[#C6CFD9] mb-4",children:[(0,b.jsx)("div",{children:a}),e&&f&&(0,b.jsxs)("div",{children:[e,", ",f]})]}),(0,b.jsx)("div",{className:"w-full h-64 rounded-lg overflow-hidden border border-white/5",children:(0,b.jsx)("iframe",{width:"100%",height:"100%",frameBorder:"0",style:{border:0},src:(()=>{if(c&&d)return`https://www.google.com/maps?q=${c},${d}&z=15&output=embed`;let b=encodeURIComponent(`${a}, ${e}, ${f}`);return`https://www.google.com/maps?q=${b}&z=15&output=embed`})(),allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"})}),(0,b.jsx)("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${a}, ${e}, ${f}`)}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-[#32CE7A] hover:text-[#6FF0C4] text-sm font-medium",children:"Open in Google Maps →"})]})}var g=a.i(40839),h=a.i(35816);function i({bookingId:a,initialNotes:d}){let[e,f]=(0,c.useState)(d),[i,j]=(0,c.useState)(""),[k,l]=(0,c.useState)(!1),m=(0,h.createClient)(),n=async b=>{if(b.preventDefault(),i.trim()){l(!0);try{let{data:b,error:c}=await m.from("booking_notes").insert({booking_id:a,note_text:i.trim()}).select().single();if(c)throw c;f([...e,b]),j("")}catch(a){console.error("Error adding note:",a),alert("Failed to add note")}finally{l(!1)}}};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Internal Notes"}),(0,b.jsxs)("form",{onSubmit:n,className:"space-y-2",children:[(0,b.jsx)("textarea",{value:i,onChange:a=>j(a.target.value),placeholder:"Add a note...",className:"w-full px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white placeholder-[#C6CFD9] focus:outline-none focus:border-[#32CE7A]/40 resize-none",rows:3}),(0,b.jsx)("button",{type:"submit",disabled:k||!i.trim(),className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Adding...":"Add Note"})]}),(0,b.jsx)("div",{className:"space-y-3",children:0===e.length?(0,b.jsx)("p",{className:"text-[#C6CFD9] text-sm",children:"No notes yet"}):e.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime()).map(a=>(0,b.jsxs)("div",{className:"bg-[#050B12] border border-white/5 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,b.jsx)("div",{className:"text-sm text-[#C6CFD9]",children:(0,g.formatDate)(a.created_at,"long")})}),(0,b.jsx)("div",{className:"text-white whitespace-pre-wrap",children:a.note_text})]},a.id))})]})}function j({timeline:a,currentStatus:c,createdAt:d}){let e=[...a].sort((a,b)=>new Date(a.changed_at).getTime()-new Date(b.changed_at).getTime());return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Job Timeline"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-white/10"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"relative flex items-start gap-4",children:[(0,b.jsx)("div",{className:"relative z-10 w-8 h-8 rounded-full bg-[#32CE7A] border-4 border-[#0A1A2F] flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})}),(0,b.jsxs)("div",{className:"flex-1 pt-1",children:[(0,b.jsx)("div",{className:"text-white font-medium",children:"Booking Created"}),(0,b.jsx)("div",{className:"text-sm text-[#C6CFD9]",children:(0,g.formatDate)(d,"long")})]})]}),e.map((a,c)=>(0,b.jsxs)("div",{className:"relative flex items-start gap-4",children:[(0,b.jsx)("div",{className:"relative z-10 w-8 h-8 rounded-full bg-[#6FF0C4] border-4 border-[#0A1A2F] flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})}),(0,b.jsxs)("div",{className:"flex-1 pt-1",children:[(0,b.jsx)("div",{className:"text-white font-medium",children:a.status_from?`${a.status_from.replace("_"," ")} → ${a.status_to.replace("_"," ")}`:`Status: ${a.status_to.replace("_"," ")}`}),(0,b.jsx)("div",{className:"text-sm text-[#C6CFD9]",children:(0,g.formatDate)(a.changed_at,"long")}),a.notes&&(0,b.jsx)("div",{className:"text-sm text-[#C6CFD9] mt-1 italic",children:a.notes})]})]},a.id)),e.length>0&&(0,b.jsxs)("div",{className:"relative flex items-start gap-4",children:[(0,b.jsx)("div",{className:"relative z-10 w-8 h-8 rounded-full bg-[#32CE7A] border-4 border-[#0A1A2F] flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})}),(0,b.jsx)("div",{className:"flex-1 pt-1",children:(0,b.jsxs)("div",{className:"text-white font-medium",children:["Current Status: ",c.replace("_"," ")]})})]})]})]})]})}function k({servicePrice:a,addonsTotal:c,taxAmount:d,totalAmount:e,tipAmount:f=0,platformFee:h}){let i=h||.1*e;return(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Payment Breakdown"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,b.jsx)("span",{children:"Service Price:"}),(0,b.jsx)("span",{className:"text-white",children:(0,g.formatCurrency)(a)})]}),c>0&&(0,b.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,b.jsx)("span",{children:"Add-ons:"}),(0,b.jsx)("span",{className:"text-white",children:(0,g.formatCurrency)(c)})]}),f>0&&(0,b.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,b.jsx)("span",{children:"Tip:"}),(0,b.jsx)("span",{className:"text-white",children:(0,g.formatCurrency)(f)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,b.jsx)("span",{children:"Tax:"}),(0,b.jsx)("span",{className:"text-white",children:(0,g.formatCurrency)(d)})]}),(0,b.jsx)("div",{className:"border-t border-white/10 pt-2 mt-2",children:(0,b.jsxs)("div",{className:"flex justify-between text-white font-semibold",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsx)("span",{children:(0,g.formatCurrency)(e)})]})}),i>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,b.jsx)("span",{children:"Platform Fee (10%):"}),(0,b.jsx)("span",{className:"text-white",children:(0,g.formatCurrency)(i)})]}),(0,b.jsx)("div",{className:"border-t border-white/10 pt-2 mt-2",children:(0,b.jsxs)("div",{className:"flex justify-between text-[#32CE7A] font-semibold",children:[(0,b.jsx)("span",{children:"Your Payout:"}),(0,b.jsx)("span",{children:(0,g.formatCurrency)(e-i)})]})})]})]})]})}function l({bookingId:a,initialPhotos:d}){let[e,f]=(0,c.useState)(d),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)("before"),m=(0,h.createClient)(),n=async b=>{let c=b.target.files?.[0];if(c){j(!0);try{let b=c.name.split(".").pop(),d=`${a}/${k}_${Date.now()}.${b}`,g=`job-photos/${d}`,{error:h}=await m.storage.from("job-photos").upload(g,c);if(h)throw h;let{data:{publicUrl:i}}=m.storage.from("job-photos").getPublicUrl(g),{data:j,error:l}=await m.from("job_photos").insert({booking_id:a,photo_url:i,photo_type:k}).select().single();if(l)throw l;f([...e,j])}catch(a){console.error("Error uploading photo:",a),alert("Failed to upload photo")}finally{j(!1)}}},o=async(a,b)=>{if(confirm("Delete this photo?"))try{let c=b.split("/job-photos/")[1];await m.storage.from("job-photos").remove([c]);let{error:d}=await m.from("job_photos").delete().eq("id",a);if(d)throw d;f(e.filter(b=>b.id!==a))}catch(a){console.error("Error deleting photo:",a),alert("Failed to delete photo")}},p=e.filter(a=>"before"===a.photo_type),q=e.filter(a=>"after"===a.photo_type);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Job Photos"}),(0,b.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,b.jsxs)("select",{value:k,onChange:a=>l(a.target.value),className:"px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white focus:outline-none focus:border-[#32CE7A]/40",children:[(0,b.jsx)("option",{value:"before",children:"Before"}),(0,b.jsx)("option",{value:"after",children:"After"})]}),(0,b.jsxs)("label",{className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg cursor-pointer transition-colors",children:[i?"Uploading...":"Upload Photo",(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:n,disabled:i,className:"hidden"})]})]}),p.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-md font-semibold text-white mb-2",children:"Before Photos"}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:p.map(a=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)("img",{src:a.photo_url,alt:"Before",className:"w-full h-48 object-cover rounded-lg border border-white/5"}),(0,b.jsx)("button",{onClick:()=>o(a.id,a.photo_url),className:"absolute top-2 right-2 p-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:"×"}),(0,b.jsx)("div",{className:"text-xs text-[#C6CFD9] mt-1",children:(0,g.formatDate)(a.uploaded_at,"short")})]},a.id))})]}),q.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-md font-semibold text-white mb-2",children:"After Photos"}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:q.map(a=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)("img",{src:a.photo_url,alt:"After",className:"w-full h-48 object-cover rounded-lg border border-white/5"}),(0,b.jsx)("button",{onClick:()=>o(a.id,a.photo_url),className:"absolute top-2 right-2 p-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:"×"}),(0,b.jsx)("div",{className:"text-xs text-[#C6CFD9] mt-1",children:(0,g.formatDate)(a.uploaded_at,"short")})]},a.id))})]}),0===e.length&&(0,b.jsx)("p",{className:"text-[#C6CFD9] text-sm",children:"No photos uploaded yet"})]})}var m=a.i(29957),n=a.i(95942);function o({booking:a,timeline:g,notes:o,photos:p,canUpdateStatus:q,canReassign:r,organizationId:s}){let[t,u]=(0,c.useState)(!1),v=(0,d.useRouter)(),w=(0,h.createClient)(),x=async b=>{let{error:c}=await w.rpc("update_booking_status",{p_booking_id:a.id,p_new_status:b});c?(console.error("Error updating status:",c),alert("Failed to update status")):v.refresh()};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-[#0A1A2F] border border-white/5 rounded-xl p-6 mb-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-white mb-2",children:[a.car?.make," ",a.car?.model," ",a.car?.year]}),(0,b.jsxs)("p",{className:"text-[#C6CFD9]",children:["Booking #",a.receipt_id]}),r&&a.detailer&&(0,b.jsxs)("p",{className:"text-sm text-[#C6CFD9] mt-1",children:["Assigned to: ",(0,b.jsx)("span",{className:"text-[#32CE7A]",children:a.detailer.full_name})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-3xl font-bold text-[#32CE7A] mb-2",children:["$",a.service?.price||a.total_amount||0]}),(0,b.jsx)(m.default,{status:a.status})]})]}),r&&(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors",children:a.detailer_id?"Reassign Job":"Assign Job"})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Service Details"}),(0,b.jsxs)("div",{className:"space-y-2 text-[#C6CFD9]",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Service:"})," ",a.service?.name]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Description:"})," ",a.service?.description||"N/A"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Scheduled:"})," ",new Date(a.scheduled_start).toLocaleString()]}),a.scheduled_end&&(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"End Time:"})," ",new Date(a.scheduled_end).toLocaleString()]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Customer Information"}),(0,b.jsxs)("div",{className:"space-y-2 text-[#C6CFD9]",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Name:"})," ",a.user?.full_name]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Phone:"})," ",a.user?.phone]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Email:"})," ",a.user?.email]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Vehicle Information"}),(0,b.jsxs)("div",{className:"space-y-2 text-[#C6CFD9]",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Make/Model:"})," ",a.car?.make," ",a.car?.model]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Year:"})," ",a.car?.year]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"License Plate:"})," ",a.car?.license_plate]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Location"}),(0,b.jsx)(f,{address:a.address_line1||"",latitude:a.latitude,longitude:a.longitude,city:a.city,province:a.province})]})]}),(0,b.jsx)("div",{className:"mt-6 pt-6 border-t border-white/10",children:(0,b.jsx)(k,{servicePrice:a.service_price||a.service?.price||0,addonsTotal:a.addons_total||0,taxAmount:a.tax_amount||0,totalAmount:a.total_amount||0})}),(0,b.jsx)("div",{className:"mt-6 pt-6 border-t border-white/10",children:(0,b.jsx)(j,{timeline:g,currentStatus:a.status,createdAt:a.created_at})}),(0,b.jsx)("div",{className:"mt-6 pt-6 border-t border-white/10",children:(0,b.jsx)(l,{bookingId:a.id,initialPhotos:p})}),(0,b.jsx)("div",{className:"mt-6 pt-6 border-t border-white/10",children:(0,b.jsx)(i,{bookingId:a.id,initialNotes:o})}),(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Contact Customer"}),(0,b.jsx)(e,{phone:a.user?.phone})]}),q&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Update Status"}),"accepted"===a.status&&(0,b.jsx)("button",{onClick:()=>x("in_progress"),className:"bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold py-2 px-6 rounded-lg transition-colors",children:"Start Service"}),"in_progress"===a.status&&(0,b.jsx)("button",{onClick:()=>x("completed"),className:"bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold py-2 px-6 rounded-lg transition-colors",children:"Mark as Completed"})]})]}),r&&s&&(0,b.jsx)(n.default,{isOpen:t,onClose:()=>u(!1),bookingId:a.id,organizationId:s,currentDetailerId:a.detailer_id,onAssigned:()=>{v.refresh()}})]})}a.s(["default",()=>o],84714)}];

//# sourceMappingURL=9c4d0_web-dashboard_app_detailer_bookings_%5Bid%5D_BookingDetailClient_tsx_1f3d8c77._.js.map
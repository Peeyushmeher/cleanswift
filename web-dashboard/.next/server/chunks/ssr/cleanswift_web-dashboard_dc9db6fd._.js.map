{"version":3,"sources":["../../../../../../cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../../cleanswift/web-dashboard/lib/detailer/permissions.ts","../../../../../../cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../../cleanswift/web-dashboard/app/detailer/settings/organization/actions.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","/**\n * Permission utilities for role-based access control\n * Defines what each role can do in the organization\n */\n\nexport enum OrganizationRole {\n  Owner = 'owner',\n  Manager = 'manager',\n  Dispatcher = 'dispatcher',\n  Detailer = 'detailer',\n}\n\nexport type OrganizationRoleType = 'owner' | 'manager' | 'dispatcher' | 'detailer';\n\n/**\n * Check if a role can assign jobs\n */\nexport function canAssignJobs(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can manage teams\n */\nexport function canManageTeams(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage members\n */\nexport function canManageMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view organization earnings\n */\nexport function canViewOrgEarnings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage organization settings\n */\nexport function canManageOrgSettings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can change member roles\n */\nexport function canChangeMemberRoles(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can remove members\n */\nexport function canRemoveMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view all organization bookings\n */\nexport function canViewAllOrgBookings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can update booking status\n */\nexport function canUpdateBookingStatus(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can create payout batches\n */\nexport function canCreatePayoutBatches(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Get all permissions for a role\n */\nexport function getRolePermissions(role: OrganizationRoleType | null) {\n  return {\n    canAssignJobs: canAssignJobs(role),\n    canManageTeams: canManageTeams(role),\n    canManageMembers: canManageMembers(role),\n    canViewOrgEarnings: canViewOrgEarnings(role),\n    canManageOrgSettings: canManageOrgSettings(role),\n    canChangeMemberRoles: canChangeMemberRoles(role),\n    canRemoveMembers: canRemoveMembers(role),\n    canViewAllOrgBookings: canViewAllOrgBookings(role),\n    canUpdateBookingStatus: canUpdateBookingStatus(role),\n    canCreatePayoutBatches: canCreatePayoutBatches(role),\n  };\n}\n\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { requireDetailer } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canManageOrgSettings } from '@/lib/detailer/permissions';\n\n/**\n * Update organization profile\n */\nexport async function updateOrganizationProfile(\n  organizationId: string,\n  name: string,\n  description: string | null\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const organization = await getDetailerOrganization();\n  if (!organization || organization.id !== organizationId) {\n    throw new Error('Organization not found');\n  }\n\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageOrgSettings(userRole)) {\n    throw new Error('You do not have permission to update organization settings');\n  }\n\n  const { error } = await supabase\n    .from('organizations')\n    .update({\n      name,\n      description,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('id', organizationId);\n\n  if (error) {\n    throw new Error('Failed to update organization profile');\n  }\n\n  return { success: true };\n}\n\n/**\n * Add a service zone\n */\nexport async function addServiceZone(organizationId: string, zoneData: any) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageOrgSettings(userRole)) {\n    throw new Error('You do not have permission to manage service zones');\n  }\n\n  // Get current organization\n  const { data: org } = await supabase\n    .from('organizations')\n    .select('service_area')\n    .eq('id', organizationId)\n    .single();\n\n  const currentZones = (org?.service_area as any[]) || [];\n  const updatedZones = [...currentZones, zoneData];\n\n  const { error } = await supabase\n    .from('organizations')\n    .update({\n      service_area: updatedZones,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('id', organizationId);\n\n  if (error) {\n    throw new Error('Failed to add service zone');\n  }\n\n  return { success: true };\n}\n\n/**\n * Delete a service zone\n */\nexport async function deleteServiceZone(organizationId: string, zoneIndex: number) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageOrgSettings(userRole)) {\n    throw new Error('You do not have permission to manage service zones');\n  }\n\n  // Get current organization\n  const { data: org } = await supabase\n    .from('organizations')\n    .select('service_area')\n    .eq('id', organizationId)\n    .single();\n\n  const currentZones = (org?.service_area as any[]) || [];\n  const updatedZones = currentZones.filter((_, idx) => idx !== zoneIndex);\n\n  const { error } = await supabase\n    .from('organizations')\n    .update({\n      service_area: updatedZones,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('id', organizationId);\n\n  if (error) {\n    throw new Error('Failed to delete service zone');\n  }\n\n  return { success: true };\n}\n\n/**\n * Update business hours\n */\nexport async function updateBusinessHours(organizationId: string, hours: any) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageOrgSettings(userRole)) {\n    throw new Error('You do not have permission to update business hours');\n  }\n\n  // For now, store in a JSONB column or separate table\n  // This is a placeholder implementation\n  const { error } = await supabase\n    .from('organizations')\n    .update({\n      business_hours: hours,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('id', organizationId);\n\n  if (error) {\n    throw new Error('Failed to update business hours');\n  }\n\n  return { success: true };\n}\n\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,2]}
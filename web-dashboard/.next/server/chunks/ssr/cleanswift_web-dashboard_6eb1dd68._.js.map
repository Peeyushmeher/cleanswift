{"version":3,"sources":["../../../../../../cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../../cleanswift/web-dashboard/lib/detailer/permissions.ts","../../../../../../cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../../cleanswift/web-dashboard/app/detailer/teams/actions.ts","../../../../../../cleanswift/web-dashboard/.next-internal/server/app/detailer/teams/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","/**\n * Permission utilities for role-based access control\n * Defines what each role can do in the organization\n */\n\nexport enum OrganizationRole {\n  Owner = 'owner',\n  Manager = 'manager',\n  Dispatcher = 'dispatcher',\n  Detailer = 'detailer',\n}\n\nexport type OrganizationRoleType = 'owner' | 'manager' | 'dispatcher' | 'detailer';\n\n/**\n * Check if a role can assign jobs\n */\nexport function canAssignJobs(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can manage teams\n */\nexport function canManageTeams(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage members\n */\nexport function canManageMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view organization earnings\n */\nexport function canViewOrgEarnings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage organization settings\n */\nexport function canManageOrgSettings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can change member roles\n */\nexport function canChangeMemberRoles(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can remove members\n */\nexport function canRemoveMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view all organization bookings\n */\nexport function canViewAllOrgBookings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can update booking status\n */\nexport function canUpdateBookingStatus(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can create payout batches\n */\nexport function canCreatePayoutBatches(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Get all permissions for a role\n */\nexport function getRolePermissions(role: OrganizationRoleType | null) {\n  return {\n    canAssignJobs: canAssignJobs(role),\n    canManageTeams: canManageTeams(role),\n    canManageMembers: canManageMembers(role),\n    canViewOrgEarnings: canViewOrgEarnings(role),\n    canManageOrgSettings: canManageOrgSettings(role),\n    canChangeMemberRoles: canChangeMemberRoles(role),\n    canRemoveMembers: canRemoveMembers(role),\n    canViewAllOrgBookings: canViewAllOrgBookings(role),\n    canUpdateBookingStatus: canUpdateBookingStatus(role),\n    canCreatePayoutBatches: canCreatePayoutBatches(role),\n  };\n}\n\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { requireDetailer } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canManageTeams } from '@/lib/detailer/permissions';\n\n/**\n * Create a new team\n */\nexport async function createTeam(\n  organizationId: string,\n  name: string,\n  description: string | null,\n  serviceArea: any,\n  detailerIds: string[]\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const organization = await getDetailerOrganization();\n  if (!organization || organization.id !== organizationId) {\n    throw new Error('Organization not found');\n  }\n\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to create teams');\n  }\n\n  // Create team\n  const { data: team, error: teamError } = await supabase\n    .from('teams')\n    .insert({\n      organization_id: organizationId,\n      name,\n      description,\n      service_area: serviceArea,\n      is_active: true,\n    })\n    .select()\n    .single();\n\n  if (teamError || !team) {\n    throw new Error('Failed to create team');\n  }\n\n  // Add team members\n  if (detailerIds.length > 0) {\n    const { error: membersError } = await supabase\n      .from('team_members')\n      .insert(\n        detailerIds.map((detailerId) => ({\n          team_id: team.id,\n          detailer_id: detailerId,\n        }))\n      );\n\n    if (membersError) {\n      console.error('Failed to add team members:', membersError);\n      // Don't throw - team was created\n    }\n  }\n\n  return team;\n}\n\n/**\n * Update a team\n */\nexport async function updateTeam(\n  teamId: string,\n  name: string,\n  description: string | null,\n  serviceArea: any,\n  detailerIds: string[]\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Get team to verify organization\n  const { data: team } = await supabase\n    .from('teams')\n    .select('organization_id')\n    .eq('id', teamId)\n    .single();\n\n  if (!team) {\n    throw new Error('Team not found');\n  }\n\n  // Check permissions\n  const userRole = await getOrganizationRole(team.organization_id);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to update teams');\n  }\n\n  // Update team\n  const { error: updateError } = await supabase\n    .from('teams')\n    .update({\n      name,\n      description,\n      service_area: serviceArea,\n    })\n    .eq('id', teamId);\n\n  if (updateError) {\n    throw new Error('Failed to update team');\n  }\n\n  // Update team members\n  // Remove all existing members\n  await supabase.from('team_members').delete().eq('team_id', teamId);\n\n  // Add new members\n  if (detailerIds.length > 0) {\n    const { error: membersError } = await supabase\n      .from('team_members')\n      .insert(\n        detailerIds.map((detailerId) => ({\n          team_id: teamId,\n          detailer_id: detailerId,\n        }))\n      );\n\n    if (membersError) {\n      console.error('Failed to update team members:', membersError);\n    }\n  }\n\n  return { success: true };\n}\n\n/**\n * Delete a team (soft delete)\n */\nexport async function deleteTeam(teamId: string) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Get team to verify organization\n  const { data: team } = await supabase\n    .from('teams')\n    .select('organization_id')\n    .eq('id', teamId)\n    .single();\n\n  if (!team) {\n    throw new Error('Team not found');\n  }\n\n  // Check permissions\n  const userRole = await getOrganizationRole(team.organization_id);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to delete teams');\n  }\n\n  // Soft delete\n  const { error } = await supabase\n    .from('teams')\n    .update({ is_active: false })\n    .eq('id', teamId);\n\n  if (error) {\n    throw new Error('Failed to delete team');\n  }\n\n  return { success: true };\n}\n\n","export {createTeam as '7c9e886cc9b6842afc1ea140e9177bb5ff09d4a3a4'} from 'ACTIONS_MODULE0'\nexport {updateTeam as '7ce42137efe2c23d4b85f8f016fe67dbee01b8d728'} from 'ACTIONS_MODULE0'\nexport {deleteTeam as '40c3272981a6808b5628b331a605ca0fd5ddb2b73e'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,2]}
{"version":3,"sources":["../../../../../../cleanswift/web-dashboard/app/detailer/members/%5Bid%5D/MemberDetailClient.tsx/__nextjs-internal-proxy.mjs","../../../../../../cleanswift/web-dashboard/app/detailer/members/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/cleanswift/web-dashboard/app/detailer/members/[id]/MemberDetailClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/cleanswift/web-dashboard/app/detailer/members/[id]/MemberDetailClient.tsx\",\n    \"default\",\n);\n","import { requireDetailer, getDetailerMode } from '@/lib/auth';\nimport { createClient } from '@/lib/supabase/server';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { redirect } from 'next/navigation';\nimport MemberDetailClient from './MemberDetailClient';\n\nexport default async function MemberDetailPage({ params }: { params: { id: string } }) {\n  const profile = await requireDetailer();\n  const mode = await getDetailerMode();\n\n  // Redirect solo detailers\n  if (mode === 'solo') {\n    redirect('/detailer/dashboard');\n  }\n\n  const supabase = await createClient();\n  const organization = await getDetailerOrganization();\n  const orgRole = organization ? await getOrganizationRole(organization.id) : null;\n\n  if (!organization) {\n    redirect('/detailer/dashboard');\n  }\n\n  // Get member details\n  const { data: members } = await supabase.rpc('get_organization_members', {\n    p_organization_id: organization.id,\n  });\n\n  const member = members?.find((m: any) => m.profile_id === params.id);\n\n  if (!member) {\n    redirect('/detailer/members');\n  }\n\n  // Get member's teams\n  const { data: detailerRecord } = await supabase\n    .from('detailers')\n    .select('id')\n    .eq('profile_id', params.id)\n    .single();\n\n  let teams: any[] = [];\n  let earnings: any = null;\n  let completedJobs: any[] = [];\n  let rating = 0;\n  let reviewCount = 0;\n\n  if (detailerRecord?.id) {\n    // Get teams\n    const { data: teamMembers } = await supabase\n      .from('team_members')\n      .select('team:teams (id, name)')\n      .eq('detailer_id', detailerRecord.id);\n\n    teams = (teamMembers || []).map((tm: any) => tm.team).filter(Boolean);\n\n    // Get earnings\n    const { data: bookings } = await supabase\n      .from('bookings')\n      .select('total_amount, service_price')\n      .eq('detailer_id', detailerRecord.id)\n      .eq('status', 'completed');\n\n    const totalEarnings = (bookings || []).reduce(\n      (sum, b) => sum + (b.total_amount || b.service_price || 0),\n      0\n    );\n\n    earnings = {\n      total: totalEarnings,\n      completedJobs: bookings?.length || 0,\n    };\n\n    // Get completed jobs\n    const { data: jobs } = await supabase\n      .from('bookings')\n      .select('id, receipt_id, completed_at, total_amount, service:service_id (name)')\n      .eq('detailer_id', detailerRecord.id)\n      .eq('status', 'completed')\n      .order('completed_at', { ascending: false })\n      .limit(10);\n\n    completedJobs = jobs || [];\n\n    // Get rating\n    const { data: detailer } = await supabase\n      .from('detailers')\n      .select('rating, review_count')\n      .eq('id', detailerRecord.id)\n      .single();\n\n    rating = detailer?.rating || 0;\n    reviewCount = detailer?.review_count || 0;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#050B12] text-white\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <MemberDetailClient\n          member={member}\n          teams={teams}\n          earnings={earnings}\n          completedJobs={completedJobs}\n          rating={rating}\n          reviewCount={reviewCount}\n          organizationId={organization.id}\n          currentUserRole={orgRole as any}\n        />\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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","ignoreList":[0]}
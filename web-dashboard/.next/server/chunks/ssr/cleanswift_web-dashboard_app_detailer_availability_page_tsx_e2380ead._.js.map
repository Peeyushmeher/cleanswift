{"version":3,"sources":["../../../../../../cleanswift/web-dashboard/app/detailer/availability/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { useRouter } from 'next/navigation';\n\ninterface AvailabilitySlot {\n  id: string;\n  day_of_week: number;\n  start_time: string;\n  end_time: string;\n  is_active: boolean;\n}\n\nconst DAY_NAMES = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\n\nexport default function AvailabilityPage() {\n  const [availability, setAvailability] = useState<AvailabilitySlot[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const router = useRouter();\n  const supabase = createClient();\n\n  useEffect(() => {\n    fetchAvailability();\n  }, []);\n\n  const fetchAvailability = async () => {\n    try {\n      setLoading(true);\n      const { data, error: fetchError } = await supabase.rpc('get_detailer_availability');\n\n      if (fetchError) throw fetchError;\n      setAvailability(data || []);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load availability');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleToggleDay = async (dayOfWeek: number) => {\n    try {\n      setSaving(true);\n      setError(null);\n\n      const existingSlot = availability.find((slot) => slot.day_of_week === dayOfWeek);\n\n      if (existingSlot) {\n        // Toggle existing slot\n        const { error: updateError } = await supabase.rpc('set_detailer_availability', {\n          p_day_of_week: dayOfWeek,\n          p_start_time: existingSlot.start_time,\n          p_end_time: existingSlot.end_time,\n          p_is_active: !existingSlot.is_active,\n        });\n\n        if (updateError) throw updateError;\n      } else {\n        // Create new slot with default hours (9 AM - 5 PM)\n        const { error: createError } = await supabase.rpc('set_detailer_availability', {\n          p_day_of_week: dayOfWeek,\n          p_start_time: '09:00:00',\n          p_end_time: '17:00:00',\n          p_is_active: true,\n        });\n\n        if (createError) throw createError;\n      }\n\n      await fetchAvailability();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update availability');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleTimeChange = async (dayOfWeek: number, field: 'start_time' | 'end_time', value: string) => {\n    try {\n      setSaving(true);\n      setError(null);\n\n      const existingSlot = availability.find((slot) => slot.day_of_week === dayOfWeek);\n      const timeValue = value.includes(':') && value.split(':').length === 2 ? `${value}:00` : value;\n\n      const { error: updateError } = await supabase.rpc('set_detailer_availability', {\n        p_day_of_week: dayOfWeek,\n        p_start_time: field === 'start_time' ? timeValue : existingSlot?.start_time || '09:00:00',\n        p_end_time: field === 'end_time' ? timeValue : existingSlot?.end_time || '17:00:00',\n        p_is_active: existingSlot?.is_active ?? true,\n      });\n\n      if (updateError) throw updateError;\n      await fetchAvailability();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update time');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const getSlotForDay = (dayOfWeek: number) => {\n    return availability.find((slot) => slot.day_of_week === dayOfWeek);\n  };\n\n  const formatTime = (time: string) => {\n    return time.substring(0, 5); // HH:mm\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-[#050B12] text-white flex items-center justify-center\">\n        <div className=\"text-[#C6CFD9]\">Loading availability...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#050B12] text-white\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Availability Management</h1>\n          <p className=\"text-[#C6CFD9]\">Set your weekly availability schedule</p>\n        </div>\n\n        {error && (\n          <div className=\"bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg text-sm mb-6\">\n            {error}\n          </div>\n        )}\n\n        <div className=\"bg-[#0A1A2F] border border-white/5 rounded-xl p-6\">\n          <div className=\"space-y-4\">\n            {DAY_NAMES.map((dayName, index) => {\n              const slot = getSlotForDay(index);\n              const isActive = slot?.is_active ?? false;\n\n              return (\n                <div\n                  key={index}\n                  className=\"flex items-center justify-between p-4 bg-[#050B12] border border-white/5 rounded-lg\"\n                >\n                  <div className=\"flex items-center gap-4\">\n                    <label className=\"flex items-center gap-3 cursor-pointer\">\n                      <input\n                        type=\"checkbox\"\n                        checked={isActive}\n                        onChange={() => handleToggleDay(index)}\n                        disabled={saving}\n                        className=\"w-5 h-5 rounded border-white/20 bg-[#0A1A2F] text-[#32CE7A] focus:ring-[#32CE7A]\"\n                      />\n                      <span className=\"text-white font-medium w-24\">{dayName}</span>\n                    </label>\n\n                    {isActive && (\n                      <div className=\"flex items-center gap-2\">\n                        <input\n                          type=\"time\"\n                          value={slot ? formatTime(slot.start_time) : '09:00'}\n                          onChange={(e) => handleTimeChange(index, 'start_time', e.target.value)}\n                          disabled={saving}\n                          className=\"px-3 py-2 bg-[#0A1A2F] border border-white/10 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-[#6FF0C4]\"\n                        />\n                        <span className=\"text-[#C6CFD9]\">to</span>\n                        <input\n                          type=\"time\"\n                          value={slot ? formatTime(slot.end_time) : '17:00'}\n                          onChange={(e) => handleTimeChange(index, 'end_time', e.target.value)}\n                          disabled={saving}\n                          className=\"px-3 py-2 bg-[#0A1A2F] border border-white/10 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-[#6FF0C4]\"\n                        />\n                      </div>\n                    )}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n\n          {saving && (\n            <div className=\"mt-4 text-[#C6CFD9] text-sm\">Saving changes...</div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}
{"version":3,"sources":["../../../../../../cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../../cleanswift/web-dashboard/lib/detailer/permissions.ts","../../../../../../cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../../cleanswift/web-dashboard/app/detailer/members/actions.ts","../../../../../../cleanswift/web-dashboard/.next-internal/server/app/detailer/members/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","/**\n * Permission utilities for role-based access control\n * Defines what each role can do in the organization\n */\n\nexport enum OrganizationRole {\n  Owner = 'owner',\n  Manager = 'manager',\n  Dispatcher = 'dispatcher',\n  Detailer = 'detailer',\n}\n\nexport type OrganizationRoleType = 'owner' | 'manager' | 'dispatcher' | 'detailer';\n\n/**\n * Check if a role can assign jobs\n */\nexport function canAssignJobs(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can manage teams\n */\nexport function canManageTeams(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage members\n */\nexport function canManageMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view organization earnings\n */\nexport function canViewOrgEarnings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage organization settings\n */\nexport function canManageOrgSettings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can change member roles\n */\nexport function canChangeMemberRoles(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can remove members\n */\nexport function canRemoveMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view all organization bookings\n */\nexport function canViewAllOrgBookings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can update booking status\n */\nexport function canUpdateBookingStatus(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can create payout batches\n */\nexport function canCreatePayoutBatches(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Get all permissions for a role\n */\nexport function getRolePermissions(role: OrganizationRoleType | null) {\n  return {\n    canAssignJobs: canAssignJobs(role),\n    canManageTeams: canManageTeams(role),\n    canManageMembers: canManageMembers(role),\n    canViewOrgEarnings: canViewOrgEarnings(role),\n    canManageOrgSettings: canManageOrgSettings(role),\n    canChangeMemberRoles: canChangeMemberRoles(role),\n    canRemoveMembers: canRemoveMembers(role),\n    canViewAllOrgBookings: canViewAllOrgBookings(role),\n    canUpdateBookingStatus: canUpdateBookingStatus(role),\n    canCreatePayoutBatches: canCreatePayoutBatches(role),\n  };\n}\n\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { requireDetailer } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canManageMembers, canChangeMemberRoles, canRemoveMembers } from '@/lib/detailer/permissions';\n\n/**\n * Invite a member to the organization\n */\nexport async function inviteMember(\n  organizationId: string,\n  email: string,\n  role: 'detailer' | 'dispatcher' | 'manager' | 'owner'\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const organization = await getDetailerOrganization();\n  if (!organization || organization.id !== organizationId) {\n    throw new Error('Organization not found');\n  }\n\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageMembers(userRole)) {\n    throw new Error('You do not have permission to invite members');\n  }\n\n  // Only owners can invite owners\n  if (role === 'owner' && userRole !== 'owner') {\n    throw new Error('Only owners can invite other owners');\n  }\n\n  // Call RPC function\n  const { data, error } = await supabase.rpc('invite_member', {\n    p_organization_id: organizationId,\n    p_email: email,\n    p_role: role,\n  });\n\n  if (error) {\n    throw new Error(error.message || 'Failed to invite member');\n  }\n\n  return data;\n}\n\n/**\n * Update a member's role\n */\nexport async function updateMemberRole(\n  organizationId: string,\n  profileId: string,\n  newRole: 'detailer' | 'dispatcher' | 'manager' | 'owner'\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canChangeMemberRoles(userRole)) {\n    throw new Error('You do not have permission to change member roles');\n  }\n\n  // Call RPC function\n  const { error } = await supabase.rpc('update_member_role', {\n    p_organization_id: organizationId,\n    p_profile_id: profileId,\n    p_new_role: newRole,\n  });\n\n  if (error) {\n    throw new Error(error.message || 'Failed to update member role');\n  }\n\n  return { success: true };\n}\n\n/**\n * Suspend a member (set is_active = false)\n */\nexport async function suspendMember(organizationId: string, profileId: string) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canRemoveMembers(userRole)) {\n    throw new Error('You do not have permission to suspend members');\n  }\n\n  // Prevent suspending yourself\n  const { data: { user } } = await supabase.auth.getUser();\n  if (user?.id === profileId) {\n    throw new Error('You cannot suspend yourself');\n  }\n\n  // Update member\n  const { error } = await supabase\n    .from('organization_members')\n    .update({ is_active: false })\n    .eq('organization_id', organizationId)\n    .eq('profile_id', profileId);\n\n  if (error) {\n    throw new Error('Failed to suspend member');\n  }\n\n  return { success: true };\n}\n\n/**\n * Activate a member (set is_active = true)\n */\nexport async function activateMember(organizationId: string, profileId: string) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canRemoveMembers(userRole)) {\n    throw new Error('You do not have permission to activate members');\n  }\n\n  // Update member\n  const { error } = await supabase\n    .from('organization_members')\n    .update({ is_active: true })\n    .eq('organization_id', organizationId)\n    .eq('profile_id', profileId);\n\n  if (error) {\n    throw new Error('Failed to activate member');\n  }\n\n  return { success: true };\n}\n\n/**\n * Remove a member from the organization\n */\nexport async function removeMember(organizationId: string, profileId: string) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canRemoveMembers(userRole)) {\n    throw new Error('You do not have permission to remove members');\n  }\n\n  // Prevent removing yourself\n  const { data: { user } } = await supabase.auth.getUser();\n  if (user?.id === profileId) {\n    throw new Error('You cannot remove yourself');\n  }\n\n  // Call RPC function\n  const { error } = await supabase.rpc('remove_member', {\n    p_organization_id: organizationId,\n    p_profile_id: profileId,\n  });\n\n  if (error) {\n    throw new Error(error.message || 'Failed to remove member');\n  }\n\n  return { success: true };\n}\n\n","export {updateMemberRole as '70441f92eace9f5c95172795179a39e8de3e56cc9c'} from 'ACTIONS_MODULE0'\nexport {suspendMember as '60cbe5e04c6b41e452e03d4194f480e00fc61fb53d'} from 'ACTIONS_MODULE0'\nexport {activateMember as '60130a1205b9140401be37ca750477dc5af6567516'} from 'ACTIONS_MODULE0'\nexport {removeMember as '60aa0c9c4e959f5cdd05e33b980a52df99e7636d8e'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,2]}
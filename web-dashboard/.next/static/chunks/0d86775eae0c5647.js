(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7801,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r={callServer:function(){return a.callServer},createServerReference:function(){return n.createServerReference},findSourceMapURL:function(){return l.findSourceMapURL}};for(var i in r)Object.defineProperty(s,i,{enumerable:!0,get:r[i]});let a=e.r(31738),l=e.r(88410),n=e.r(61631)},41381,e=>{"use strict";function t(e){let t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}function s(e,t="short"){let r="string"==typeof e?new Date(e):e;return"time"===t?r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"long"===t?r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function r(e){switch(e){case"accepted":return"bg-[#1DA4F3]/20 border-[#1DA4F3]/40 text-[#1DA4F3]";case"in_progress":return"bg-[#6FF0C4]/20 border-[#6FF0C4]/40 text-[#6FF0C4]";case"completed":return"bg-[#32CE7A]/20 border-[#32CE7A]/40 text-[#32CE7A]";case"cancelled":case"no_show":return"bg-red-500/20 border-red-500/40 text-red-400";case"paid":case"offered":return"bg-yellow-500/20 border-yellow-500/40 text-yellow-400";default:return"bg-[#C6CFD9]/20 border-[#C6CFD9]/40 text-[#C6CFD9]"}}function i(e){switch(e){case"paid":return"text-[#32CE7A]";case"processing":return"text-yellow-400";case"failed":case"refunded":return"text-red-400";default:return"text-[#C6CFD9]"}}function a(e,t){if("all"===t)return e;let s=new Date,r=new Date(s.getFullYear(),s.getMonth(),s.getDate());return e.filter(e=>{let s=e.scheduled_date?new Date(e.scheduled_date):e.scheduled_start?new Date(e.scheduled_start):null;if(!s)return!1;let i=new Date(s.getFullYear(),s.getMonth(),s.getDate());switch(t){case"today":return i.getTime()===r.getTime();case"tomorrow":let a=new Date(r);return a.setDate(a.getDate()+1),i.getTime()===a.getTime();case"this_week":let l=new Date(r);l.setDate(r.getDate()-r.getDay());let n=new Date(l);return n.setDate(l.getDate()+6),s>=l&&s<=n;case"this_month":return s.getMonth()===r.getMonth()&&s.getFullYear()===r.getFullYear();default:return!0}})}function l(e,t){let s=[...e];switch(t){case"time":return s.sort((e,t)=>{let s=e.scheduled_date||e.scheduled_start||"",r=t.scheduled_date||t.scheduled_start||"";return new Date(s).getTime()-new Date(r).getTime()});case"price":return s.sort((e,t)=>{let s=e.total_amount||e.service_price||0;return(t.total_amount||t.service_price||0)-s});case"distance":case"rating":default:return s;case"assignment":return s.sort((e,t)=>{let s=new Date(e.created_at||0).getTime();return new Date(t.created_at||0).getTime()-s})}}e.s(["filterBookingsByDateRange",()=>a,"formatCurrency",()=>t,"formatDate",()=>s,"getPaymentStatusColor",()=>i,"getStatusColor",()=>r,"sortBookings",()=>l])},93110,25837,88510,e=>{"use strict";var t=e.i(84394),s=e.i(41381);function r({status:e,className:r=""}){let i=(0,s.getStatusColor)(e);return(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded-full border ${i} ${r}`,children:e.replace("_"," ")})}e.s(["default",()=>r],93110);var i=e.i(67589),a=e.i(76708);function l({size:e="md",className:s=""}){return(0,t.jsx)("div",{className:`flex items-center justify-center ${s}`,children:(0,t.jsx)("div",{className:`${{sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[e]} border-4 border-[#0A1A2F] border-t-[#32CE7A] rounded-full animate-spin`,role:"status","aria-label":"Loading",children:(0,t.jsx)("span",{className:"sr-only",children:"Loading..."})})})}e.s(["default",()=>l],25837);var n=e.i(7801),o=(0,n.createServerReference)("60d858c2f9116937f1ff29a4433a628e709b07024a",n.callServer,void 0,n.findSourceMapURL,"assignJobToDetailer");function d({isOpen:e,onClose:s,bookingId:r,organizationId:n,currentDetailerId:d,onAssigned:c}){let[h,x]=(0,i.useState)([]),[m,u]=(0,i.useState)(!1),[g,p]=(0,i.useState)(!1),[f,b]=(0,i.useState)(""),[j,v]=(0,i.useState)(""),[w,N]=(0,i.useState)("all"),[C,y]=(0,i.useState)([]),_=(0,a.createClient)();(0,i.useEffect)(()=>{e&&(A(),D())},[e,n]);let D=async()=>{let{data:e}=await _.from("teams").select("id, name").eq("organization_id",n).eq("is_active",!0);y(e||[])},A=async()=>{u(!0);try{let{data:e}=await _.rpc("get_organization_members",{p_organization_id:n}),t=(e||[]).filter(e=>"detailer"===e.role&&e.is_active).map(e=>e.profile_id);if(0===t.length){x([]),u(!1);return}let{data:s}=await _.from("detailers").select("id, full_name, rating, review_count").in("profile_id",t),{data:r}=await _.from("bookings").select("detailer_id").eq("organization_id",n).in("status",["accepted","in_progress","scheduled"]),i={};r?.forEach(e=>{e.detailer_id&&(i[e.detailer_id]=(i[e.detailer_id]||0)+1)});let a=(s||[]).map(e=>({id:e.id,full_name:e.full_name,rating:e.rating||0,review_count:e.review_count||0,current_job_count:i[e.id]||0,is_available:!0}));x(a)}catch(e){console.error("Error loading detailers:",e)}finally{u(!1)}},F=async()=>{if(f){p(!0);try{await o(r,f),c(),s()}catch(e){console.error("Error assigning job:",e),alert("Failed to assign job. Please try again.")}finally{p(!1)}}},S=h.filter(e=>e.full_name.toLowerCase().includes(j.toLowerCase()));return e?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),(0,t.jsxs)("div",{className:"relative z-10 w-full max-w-2xl mx-4 bg-[#0A1A2F] border border-white/5 rounded-xl shadow-xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,t.jsx)("div",{className:"p-6 border-b border-white/5",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Assign Job to Detailer"}),(0,t.jsx)("button",{onClick:s,className:"text-[#C6CFD9] hover:text-white transition-colors",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,t.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,t.jsx)("input",{type:"text",placeholder:"Search detailers...",value:j,onChange:e=>v(e.target.value),className:"w-full px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white placeholder-[#C6CFD9] focus:outline-none focus:border-[#32CE7A]/40"}),C.length>0&&(0,t.jsxs)("select",{value:w,onChange:e=>N(e.target.value),className:"w-full px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white focus:outline-none focus:border-[#32CE7A]/40",children:[(0,t.jsx)("option",{value:"all",children:"All Teams"}),C.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),m?(0,t.jsx)("div",{className:"flex justify-center py-12",children:(0,t.jsx)(l,{size:"lg"})}):0===S.length?(0,t.jsx)("div",{className:"text-center py-12 text-[#C6CFD9]",children:"No detailers found"}):(0,t.jsx)("div",{className:"space-y-2",children:S.map(e=>(0,t.jsx)("button",{onClick:()=>b(e.id),className:`
                    w-full p-4 rounded-lg border transition-colors text-left
                    ${f===e.id?"bg-[#32CE7A]/20 border-[#32CE7A]/40":"bg-[#050B12] border-white/5 hover:border-white/10"}
                    ${e.id===d?"opacity-50 cursor-not-allowed":""}
                  `,disabled:e.id===d,children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h3",{className:"font-semibold text-white",children:e.full_name}),e.id===d&&(0,t.jsx)("span",{className:"text-xs bg-[#32CE7A]/20 text-[#32CE7A] px-2 py-1 rounded",children:"Current"})]}),(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-4 text-sm text-[#C6CFD9]",children:[(0,t.jsxs)("span",{children:["â­ ",e.rating.toFixed(1)," (",e.review_count," reviews)"]}),(0,t.jsxs)("span",{children:["ðŸ“‹ ",e.current_job_count," active jobs"]}),e.distance&&(0,t.jsxs)("span",{children:["ðŸ“ ",e.distance.toFixed(1)," km"]})]})]}),f===e.id&&(0,t.jsx)("div",{className:"ml-4",children:(0,t.jsx)("div",{className:"w-5 h-5 rounded-full bg-[#32CE7A] flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]})},e.id))})]}),(0,t.jsxs)("div",{className:"p-6 border-t border-white/5 flex justify-end gap-3",children:[(0,t.jsx)("button",{onClick:s,className:"px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white hover:border-white/10 transition-colors",children:"Cancel"}),(0,t.jsx)("button",{onClick:F,disabled:!f||g,className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Assigning...":"Assign Job"})]})]})]}):null}e.s(["default",()=>d],88510)},87522,e=>{"use strict";var t=e.i(84394),s=e.i(67589),r=e.i(50067);function i({phone:e}){return e?(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("a",{href:`tel:${e}`,className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors",children:["Call ",e]}),(0,t.jsx)("button",{onClick:()=>{e&&(navigator.clipboard.writeText(e),alert("Phone number copied to clipboard"))},className:"px-4 py-2 bg-[#0A1A2F] border border-white/5 hover:border-[#32CE7A]/40 text-white font-semibold rounded-lg transition-colors",children:"Copy Phone"})]}):null}function a({address:e,latitude:s,longitude:r,city:i,province:a}){return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Location"}),(0,t.jsxs)("div",{className:"text-[#C6CFD9] mb-4",children:[(0,t.jsx)("div",{children:e}),i&&a&&(0,t.jsxs)("div",{children:[i,", ",a]})]}),(0,t.jsx)("div",{className:"w-full h-64 rounded-lg overflow-hidden border border-white/5",children:(0,t.jsx)("iframe",{width:"100%",height:"100%",frameBorder:"0",style:{border:0},src:(()=>{if(s&&r)return`https://www.google.com/maps?q=${s},${r}&z=15&output=embed`;let t=encodeURIComponent(`${e}, ${i}, ${a}`);return`https://www.google.com/maps?q=${t}&z=15&output=embed`})(),allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"})}),(0,t.jsx)("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${e}, ${i}, ${a}`)}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-[#32CE7A] hover:text-[#6FF0C4] text-sm font-medium",children:"Open in Google Maps â†’"})]})}var l=e.i(41381),n=e.i(76708);function o({bookingId:e,initialNotes:r}){let[i,a]=(0,s.useState)(r),[o,d]=(0,s.useState)(""),[c,h]=(0,s.useState)(!1),x=(0,n.createClient)(),m=async t=>{if(t.preventDefault(),o.trim()){h(!0);try{let{data:t,error:s}=await x.from("booking_notes").insert({booking_id:e,note_text:o.trim()}).select().single();if(s)throw s;a([...i,t]),d("")}catch(e){console.error("Error adding note:",e),alert("Failed to add note")}finally{h(!1)}}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Internal Notes"}),(0,t.jsxs)("form",{onSubmit:m,className:"space-y-2",children:[(0,t.jsx)("textarea",{value:o,onChange:e=>d(e.target.value),placeholder:"Add a note...",className:"w-full px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white placeholder-[#C6CFD9] focus:outline-none focus:border-[#32CE7A]/40 resize-none",rows:3}),(0,t.jsx)("button",{type:"submit",disabled:c||!o.trim(),className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Adding...":"Add Note"})]}),(0,t.jsx)("div",{className:"space-y-3",children:0===i.length?(0,t.jsx)("p",{className:"text-[#C6CFD9] text-sm",children:"No notes yet"}):i.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).map(e=>(0,t.jsxs)("div",{className:"bg-[#050B12] border border-white/5 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,t.jsx)("div",{className:"text-sm text-[#C6CFD9]",children:(0,l.formatDate)(e.created_at,"long")})}),(0,t.jsx)("div",{className:"text-white whitespace-pre-wrap",children:e.note_text})]},e.id))})]})}function d({timeline:e,currentStatus:s,createdAt:r}){let i=[...e].sort((e,t)=>new Date(e.changed_at).getTime()-new Date(t.changed_at).getTime());return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Job Timeline"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-white/10"}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"relative flex items-start gap-4",children:[(0,t.jsx)("div",{className:"relative z-10 w-8 h-8 rounded-full bg-[#32CE7A] border-4 border-[#0A1A2F] flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})}),(0,t.jsxs)("div",{className:"flex-1 pt-1",children:[(0,t.jsx)("div",{className:"text-white font-medium",children:"Booking Created"}),(0,t.jsx)("div",{className:"text-sm text-[#C6CFD9]",children:(0,l.formatDate)(r,"long")})]})]}),i.map((e,s)=>(0,t.jsxs)("div",{className:"relative flex items-start gap-4",children:[(0,t.jsx)("div",{className:"relative z-10 w-8 h-8 rounded-full bg-[#6FF0C4] border-4 border-[#0A1A2F] flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})}),(0,t.jsxs)("div",{className:"flex-1 pt-1",children:[(0,t.jsx)("div",{className:"text-white font-medium",children:e.status_from?`${e.status_from.replace("_"," ")} â†’ ${e.status_to.replace("_"," ")}`:`Status: ${e.status_to.replace("_"," ")}`}),(0,t.jsx)("div",{className:"text-sm text-[#C6CFD9]",children:(0,l.formatDate)(e.changed_at,"long")}),e.notes&&(0,t.jsx)("div",{className:"text-sm text-[#C6CFD9] mt-1 italic",children:e.notes})]})]},e.id)),i.length>0&&(0,t.jsxs)("div",{className:"relative flex items-start gap-4",children:[(0,t.jsx)("div",{className:"relative z-10 w-8 h-8 rounded-full bg-[#32CE7A] border-4 border-[#0A1A2F] flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})}),(0,t.jsx)("div",{className:"flex-1 pt-1",children:(0,t.jsxs)("div",{className:"text-white font-medium",children:["Current Status: ",s.replace("_"," ")]})})]})]})]})]})}function c({servicePrice:e,addonsTotal:s,taxAmount:r,totalAmount:i,tipAmount:a=0,platformFee:n}){let o=n||.1*i;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Payment Breakdown"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,t.jsx)("span",{children:"Service Price:"}),(0,t.jsx)("span",{className:"text-white",children:(0,l.formatCurrency)(e)})]}),s>0&&(0,t.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,t.jsx)("span",{children:"Add-ons:"}),(0,t.jsx)("span",{className:"text-white",children:(0,l.formatCurrency)(s)})]}),a>0&&(0,t.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,t.jsx)("span",{children:"Tip:"}),(0,t.jsx)("span",{className:"text-white",children:(0,l.formatCurrency)(a)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,t.jsx)("span",{children:"Tax:"}),(0,t.jsx)("span",{className:"text-white",children:(0,l.formatCurrency)(r)})]}),(0,t.jsx)("div",{className:"border-t border-white/10 pt-2 mt-2",children:(0,t.jsxs)("div",{className:"flex justify-between text-white font-semibold",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsx)("span",{children:(0,l.formatCurrency)(i)})]})}),o>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between text-[#C6CFD9]",children:[(0,t.jsx)("span",{children:"Platform Fee (10%):"}),(0,t.jsx)("span",{className:"text-white",children:(0,l.formatCurrency)(o)})]}),(0,t.jsx)("div",{className:"border-t border-white/10 pt-2 mt-2",children:(0,t.jsxs)("div",{className:"flex justify-between text-[#32CE7A] font-semibold",children:[(0,t.jsx)("span",{children:"Your Payout:"}),(0,t.jsx)("span",{children:(0,l.formatCurrency)(i-o)})]})})]})]})]})}function h({bookingId:e,initialPhotos:r}){let[i,a]=(0,s.useState)(r),[o,d]=(0,s.useState)(!1),[c,h]=(0,s.useState)("before"),x=(0,n.createClient)(),m=async t=>{let s=t.target.files?.[0];if(s){d(!0);try{let t=s.name.split(".").pop(),r=`${e}/${c}_${Date.now()}.${t}`,l=`job-photos/${r}`,{error:n}=await x.storage.from("job-photos").upload(l,s);if(n)throw n;let{data:{publicUrl:o}}=x.storage.from("job-photos").getPublicUrl(l),{data:d,error:h}=await x.from("job_photos").insert({booking_id:e,photo_url:o,photo_type:c}).select().single();if(h)throw h;a([...i,d])}catch(e){console.error("Error uploading photo:",e),alert("Failed to upload photo")}finally{d(!1)}}},u=async(e,t)=>{if(confirm("Delete this photo?"))try{let s=t.split("/job-photos/")[1];await x.storage.from("job-photos").remove([s]);let{error:r}=await x.from("job_photos").delete().eq("id",e);if(r)throw r;a(i.filter(t=>t.id!==e))}catch(e){console.error("Error deleting photo:",e),alert("Failed to delete photo")}},g=i.filter(e=>"before"===e.photo_type),p=i.filter(e=>"after"===e.photo_type);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Job Photos"}),(0,t.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,t.jsxs)("select",{value:c,onChange:e=>h(e.target.value),className:"px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white focus:outline-none focus:border-[#32CE7A]/40",children:[(0,t.jsx)("option",{value:"before",children:"Before"}),(0,t.jsx)("option",{value:"after",children:"After"})]}),(0,t.jsxs)("label",{className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg cursor-pointer transition-colors",children:[o?"Uploading...":"Upload Photo",(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:m,disabled:o,className:"hidden"})]})]}),g.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-md font-semibold text-white mb-2",children:"Before Photos"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:g.map(e=>(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("img",{src:e.photo_url,alt:"Before",className:"w-full h-48 object-cover rounded-lg border border-white/5"}),(0,t.jsx)("button",{onClick:()=>u(e.id,e.photo_url),className:"absolute top-2 right-2 p-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:"Ã—"}),(0,t.jsx)("div",{className:"text-xs text-[#C6CFD9] mt-1",children:(0,l.formatDate)(e.uploaded_at,"short")})]},e.id))})]}),p.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-md font-semibold text-white mb-2",children:"After Photos"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:p.map(e=>(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("img",{src:e.photo_url,alt:"After",className:"w-full h-48 object-cover rounded-lg border border-white/5"}),(0,t.jsx)("button",{onClick:()=>u(e.id,e.photo_url),className:"absolute top-2 right-2 p-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:"Ã—"}),(0,t.jsx)("div",{className:"text-xs text-[#C6CFD9] mt-1",children:(0,l.formatDate)(e.uploaded_at,"short")})]},e.id))})]}),0===i.length&&(0,t.jsx)("p",{className:"text-[#C6CFD9] text-sm",children:"No photos uploaded yet"})]})}var x=e.i(93110),m=e.i(88510);function u({booking:e,timeline:l,notes:u,photos:g,canUpdateStatus:p,canReassign:f,organizationId:b}){let[j,v]=(0,s.useState)(!1),w=(0,r.useRouter)(),N=(0,n.createClient)(),C=async t=>{let{error:s}=await N.rpc("update_booking_status",{p_booking_id:e.id,p_new_status:t});s?(console.error("Error updating status:",s),alert("Failed to update status")):w.refresh()};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-[#0A1A2F] border border-white/5 rounded-xl p-6 mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-white mb-2",children:[e.car?.make," ",e.car?.model," ",e.car?.year]}),(0,t.jsxs)("p",{className:"text-[#C6CFD9]",children:["Booking #",e.receipt_id]}),f&&e.detailer&&(0,t.jsxs)("p",{className:"text-sm text-[#C6CFD9] mt-1",children:["Assigned to: ",(0,t.jsx)("span",{className:"text-[#32CE7A]",children:e.detailer.full_name})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"text-3xl font-bold text-[#32CE7A] mb-2",children:["$",e.service?.price||e.total_amount||0]}),(0,t.jsx)(x.default,{status:e.status})]})]}),f&&(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors",children:e.detailer_id?"Reassign Job":"Assign Job"})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Service Details"}),(0,t.jsxs)("div",{className:"space-y-2 text-[#C6CFD9]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Service:"})," ",e.service?.name]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Description:"})," ",e.service?.description||"N/A"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Scheduled:"})," ",new Date(e.scheduled_start).toLocaleString()]}),e.scheduled_end&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"End Time:"})," ",new Date(e.scheduled_end).toLocaleString()]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Customer Information"}),(0,t.jsxs)("div",{className:"space-y-2 text-[#C6CFD9]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Name:"})," ",e.user?.full_name]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Phone:"})," ",e.user?.phone]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Email:"})," ",e.user?.email]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Vehicle Information"}),(0,t.jsxs)("div",{className:"space-y-2 text-[#C6CFD9]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Make/Model:"})," ",e.car?.make," ",e.car?.model]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Year:"})," ",e.car?.year]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"License Plate:"})," ",e.car?.license_plate]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Location"}),(0,t.jsx)(a,{address:e.address_line1||"",latitude:e.latitude,longitude:e.longitude,city:e.city,province:e.province})]})]}),(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-white/10",children:(0,t.jsx)(c,{servicePrice:e.service_price||e.service?.price||0,addonsTotal:e.addons_total||0,taxAmount:e.tax_amount||0,totalAmount:e.total_amount||0})}),(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-white/10",children:(0,t.jsx)(d,{timeline:l,currentStatus:e.status,createdAt:e.created_at})}),(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-white/10",children:(0,t.jsx)(h,{bookingId:e.id,initialPhotos:g})}),(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-white/10",children:(0,t.jsx)(o,{bookingId:e.id,initialNotes:u})}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Contact Customer"}),(0,t.jsx)(i,{phone:e.user?.phone})]}),p&&(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Update Status"}),"accepted"===e.status&&(0,t.jsx)("button",{onClick:()=>C("in_progress"),className:"bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold py-2 px-6 rounded-lg transition-colors",children:"Start Service"}),"in_progress"===e.status&&(0,t.jsx)("button",{onClick:()=>C("completed"),className:"bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold py-2 px-6 rounded-lg transition-colors",children:"Mark as Completed"})]})]}),f&&b&&(0,t.jsx)(m.default,{isOpen:j,onClose:()=>v(!1),bookingId:e.id,organizationId:b,currentDetailerId:e.detailer_id,onAssigned:()=>{w.refresh()}})]})}e.s(["default",()=>u],87522)}]);
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/cleanswift/web-dashboard/middleware.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { NextResponse, type NextRequest } from 'next/server';\n\nexport async function middleware(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request: {\n      headers: request.headers,\n    },\n  });\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value, options }) =>\n            request.cookies.set(name, value)\n          );\n          supabaseResponse = NextResponse.next({\n            request,\n          });\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options)\n          );\n        },\n      },\n    }\n  );\n\n  const {\n    data: { session },\n  } = await supabase.auth.getSession();\n\n  const { pathname } = request.nextUrl;\n\n  // Protect detailer routes\n  if (pathname.startsWith('/detailer')) {\n    if (!session) {\n      return NextResponse.redirect(new URL('/auth/login', request.url));\n    }\n\n    // Check user role\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', session.user.id)\n      .single();\n\n    if (!profile || (profile.role !== 'detailer' && profile.role !== 'admin')) {\n      return NextResponse.redirect(new URL('/auth/login', request.url));\n    }\n  }\n\n  // Protect admin routes\n  if (pathname.startsWith('/admin')) {\n    if (!session) {\n      return NextResponse.redirect(new URL('/auth/login', request.url));\n    }\n\n    // Check user role\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', session.user.id)\n      .single();\n\n    if (!profile || profile.role !== 'admin') {\n      return NextResponse.redirect(new URL('/auth/login', request.url));\n    }\n  }\n\n  // Redirect authenticated users away from login page\n  if (pathname.startsWith('/auth/login') && session) {\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', session.user.id)\n      .single();\n\n    if (profile) {\n      if (profile.role === 'admin') {\n        return NextResponse.redirect(new URL('/admin/dashboard', request.url));\n      } else if (profile.role === 'detailer') {\n        return NextResponse.redirect(new URL('/detailer/dashboard', request.url));\n      }\n    }\n  }\n\n  return supabaseResponse;\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n};\n\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,IAAI,mBAAmB,kOAAY,CAAC,IAAI,CAAC;QACvC,SAAS;YACP,SAAS,QAAQ,OAAO;QAC1B;IACF;IAEA,MAAM,WAAW,IAAA,yOAAkB,EACjC,QAAQ,GAAG,CAAC,wBAAwB,EACpC,QAAQ,GAAG,CAAC,6BAA6B,EACzC;QACE,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBAE5B,mBAAmB,kOAAY,CAAC,IAAI,CAAC;oBACnC;gBACF;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAE9C;QACF;IACF;IAGF,MAAM,EACJ,MAAM,EAAE,OAAO,EAAE,EAClB,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAElC,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,0BAA0B;IAC1B,IAAI,SAAS,UAAU,CAAC,cAAc;QACpC,IAAI,CAAC,SAAS;YACZ,OAAO,kOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;QACjE;QAEA,kBAAkB;QAClB,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;QAET,IAAI,CAAC,WAAY,QAAQ,IAAI,KAAK,cAAc,QAAQ,IAAI,KAAK,SAAU;YACzE,OAAO,kOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;QACjE;IACF;IAEA,uBAAuB;IACvB,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,IAAI,CAAC,SAAS;YACZ,OAAO,kOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;QACjE;QAEA,kBAAkB;QAClB,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;QAET,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,SAAS;YACxC,OAAO,kOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;QACjE;IACF;IAEA,oDAAoD;IACpD,IAAI,SAAS,UAAU,CAAC,kBAAkB,SAAS;QACjD,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;QAET,IAAI,SAAS;YACX,IAAI,QAAQ,IAAI,KAAK,SAAS;gBAC5B,OAAO,kOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,oBAAoB,QAAQ,GAAG;YACtE,OAAO,IAAI,QAAQ,IAAI,KAAK,YAAY;gBACtC,OAAO,kOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,uBAAuB,QAAQ,GAAG;YACzE;QACF;IACF;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}
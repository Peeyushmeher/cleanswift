{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/teams/actions.ts"],"sourcesContent":["'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { requireDetailer } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canManageTeams } from '@/lib/detailer/permissions';\n\n/**\n * Create a new team\n */\nexport async function createTeam(\n  organizationId: string,\n  name: string,\n  description: string | null,\n  serviceArea: any,\n  detailerIds: string[]\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const organization = await getDetailerOrganization();\n  if (!organization || organization.id !== organizationId) {\n    throw new Error('Organization not found');\n  }\n\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to create teams');\n  }\n\n  // Create team\n  const { data: team, error: teamError } = await supabase\n    .from('teams')\n    .insert({\n      organization_id: organizationId,\n      name,\n      description,\n      service_area: serviceArea,\n      is_active: true,\n    })\n    .select()\n    .single();\n\n  if (teamError || !team) {\n    throw new Error('Failed to create team');\n  }\n\n  // Add team members\n  if (detailerIds.length > 0) {\n    const { error: membersError } = await supabase\n      .from('team_members')\n      .insert(\n        detailerIds.map((detailerId) => ({\n          team_id: team.id,\n          detailer_id: detailerId,\n        }))\n      );\n\n    if (membersError) {\n      console.error('Failed to add team members:', membersError);\n      // Don't throw - team was created\n    }\n  }\n\n  return team;\n}\n\n/**\n * Update a team\n */\nexport async function updateTeam(\n  teamId: string,\n  name: string,\n  description: string | null,\n  serviceArea: any,\n  detailerIds: string[]\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Get team to verify organization\n  const { data: team } = await supabase\n    .from('teams')\n    .select('organization_id')\n    .eq('id', teamId)\n    .single();\n\n  if (!team) {\n    throw new Error('Team not found');\n  }\n\n  // Check permissions\n  const userRole = await getOrganizationRole(team.organization_id);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to update teams');\n  }\n\n  // Update team\n  const { error: updateError } = await supabase\n    .from('teams')\n    .update({\n      name,\n      description,\n      service_area: serviceArea,\n    })\n    .eq('id', teamId);\n\n  if (updateError) {\n    throw new Error('Failed to update team');\n  }\n\n  // Update team members\n  // Remove all existing members\n  await supabase.from('team_members').delete().eq('team_id', teamId);\n\n  // Add new members\n  if (detailerIds.length > 0) {\n    const { error: membersError } = await supabase\n      .from('team_members')\n      .insert(\n        detailerIds.map((detailerId) => ({\n          team_id: teamId,\n          detailer_id: detailerId,\n        }))\n      );\n\n    if (membersError) {\n      console.error('Failed to update team members:', membersError);\n    }\n  }\n\n  return { success: true };\n}\n\n/**\n * Delete a team (soft delete)\n */\nexport async function deleteTeam(teamId: string) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Get team to verify organization\n  const { data: team } = await supabase\n    .from('teams')\n    .select('organization_id')\n    .eq('id', teamId)\n    .single();\n\n  if (!team) {\n    throw new Error('Team not found');\n  }\n\n  // Check permissions\n  const userRole = await getOrganizationRole(team.organization_id);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to delete teams');\n  }\n\n  // Soft delete\n  const { error } = await supabase\n    .from('teams')\n    .update({ is_active: false })\n    .eq('id', teamId);\n\n  if (error) {\n    throw new Error('Failed to delete team');\n  }\n\n  return { success: true };\n}\n\n"],"names":[],"mappings":";;;;;;;IAUsB,aAAA,WAAA,GAAA,IAAA,iRAAA,EAAA,8CAAA,sQAAA,EAAA,KAAA,GAAA,4QAAA,EAAA"}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/teams/actions.ts"],"sourcesContent":["'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { requireDetailer } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canManageTeams } from '@/lib/detailer/permissions';\n\n/**\n * Create a new team\n */\nexport async function createTeam(\n  organizationId: string,\n  name: string,\n  description: string | null,\n  serviceArea: any,\n  detailerIds: string[]\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const organization = await getDetailerOrganization();\n  if (!organization || organization.id !== organizationId) {\n    throw new Error('Organization not found');\n  }\n\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to create teams');\n  }\n\n  // Create team\n  const { data: team, error: teamError } = await supabase\n    .from('teams')\n    .insert({\n      organization_id: organizationId,\n      name,\n      description,\n      service_area: serviceArea,\n      is_active: true,\n    })\n    .select()\n    .single();\n\n  if (teamError || !team) {\n    throw new Error('Failed to create team');\n  }\n\n  // Add team members\n  if (detailerIds.length > 0) {\n    const { error: membersError } = await supabase\n      .from('team_members')\n      .insert(\n        detailerIds.map((detailerId) => ({\n          team_id: team.id,\n          detailer_id: detailerId,\n        }))\n      );\n\n    if (membersError) {\n      console.error('Failed to add team members:', membersError);\n      // Don't throw - team was created\n    }\n  }\n\n  return team;\n}\n\n/**\n * Update a team\n */\nexport async function updateTeam(\n  teamId: string,\n  name: string,\n  description: string | null,\n  serviceArea: any,\n  detailerIds: string[]\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Get team to verify organization\n  const { data: team } = await supabase\n    .from('teams')\n    .select('organization_id')\n    .eq('id', teamId)\n    .single();\n\n  if (!team) {\n    throw new Error('Team not found');\n  }\n\n  // Check permissions\n  const userRole = await getOrganizationRole(team.organization_id);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to update teams');\n  }\n\n  // Update team\n  const { error: updateError } = await supabase\n    .from('teams')\n    .update({\n      name,\n      description,\n      service_area: serviceArea,\n    })\n    .eq('id', teamId);\n\n  if (updateError) {\n    throw new Error('Failed to update team');\n  }\n\n  // Update team members\n  // Remove all existing members\n  await supabase.from('team_members').delete().eq('team_id', teamId);\n\n  // Add new members\n  if (detailerIds.length > 0) {\n    const { error: membersError } = await supabase\n      .from('team_members')\n      .insert(\n        detailerIds.map((detailerId) => ({\n          team_id: teamId,\n          detailer_id: detailerId,\n        }))\n      );\n\n    if (membersError) {\n      console.error('Failed to update team members:', membersError);\n    }\n  }\n\n  return { success: true };\n}\n\n/**\n * Delete a team (soft delete)\n */\nexport async function deleteTeam(teamId: string) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Get team to verify organization\n  const { data: team } = await supabase\n    .from('teams')\n    .select('organization_id')\n    .eq('id', teamId)\n    .single();\n\n  if (!team) {\n    throw new Error('Team not found');\n  }\n\n  // Check permissions\n  const userRole = await getOrganizationRole(team.organization_id);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to delete teams');\n  }\n\n  // Soft delete\n  const { error } = await supabase\n    .from('teams')\n    .update({ is_active: false })\n    .eq('id', teamId);\n\n  if (error) {\n    throw new Error('Failed to delete team');\n  }\n\n  return { success: true };\n}\n\n"],"names":[],"mappings":";;;;;;;IAuEsB,aAAA,WAAA,GAAA,IAAA,iRAAA,EAAA,8CAAA,sQAAA,EAAA,KAAA,GAAA,4QAAA,EAAA"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/components/detailer/TeamForm.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { createTeam, updateTeam } from '@/app/detailer/teams/actions';\n\ninterface TeamFormProps {\n  isOpen: boolean;\n  onClose: () => void;\n  organizationId: string;\n  team?: {\n    id: string;\n    name: string;\n    description: string | null;\n    service_area: any;\n  } | null;\n  onSaved: () => void;\n}\n\nexport default function TeamForm({\n  isOpen,\n  onClose,\n  organizationId,\n  team,\n  onSaved,\n}: TeamFormProps) {\n  const [name, setName] = useState('');\n  const [description, setDescription] = useState('');\n  const [serviceArea, setServiceArea] = useState<{\n    cities?: string[];\n    provinces?: string[];\n    postalCodes?: string[];\n  }>({});\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [availableDetailers, setAvailableDetailers] = useState<any[]>([]);\n  const [selectedDetailers, setSelectedDetailers] = useState<string[]>([]);\n  const supabase = createClient();\n\n  useEffect(() => {\n    if (isOpen) {\n      if (team) {\n        setName(team.name);\n        setDescription(team.description || '');\n        setServiceArea(team.service_area || {});\n        loadTeamMembers();\n      } else {\n        setName('');\n        setDescription('');\n        setServiceArea({});\n        setSelectedDetailers([]);\n      }\n      loadAvailableDetailers();\n    }\n  }, [isOpen, team]);\n\n  const loadAvailableDetailers = async () => {\n    const { data: members } = await supabase.rpc('get_organization_members', {\n      p_organization_id: organizationId,\n    });\n\n    const detailerMembers = (members || []).filter((m: any) => m.role === 'detailer' && m.is_active);\n    const detailerIds = detailerMembers.map((m: any) => m.profile_id);\n\n    if (detailerIds.length === 0) {\n      setAvailableDetailers([]);\n      return;\n    }\n\n    const { data: detailerRecords } = await supabase\n      .from('detailers')\n      .select('id, full_name')\n      .in('profile_id', detailerIds);\n\n    setAvailableDetailers(detailerRecords || []);\n  };\n\n  const loadTeamMembers = async () => {\n    if (!team) return;\n\n    const { data: teamMembers } = await supabase\n      .from('team_members')\n      .select('detailer_id')\n      .eq('team_id', team.id);\n\n    setSelectedDetailers((teamMembers || []).map((tm: any) => tm.detailer_id));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setLoading(true);\n\n    try {\n      if (team) {\n        await updateTeam(team.id, name, description || null, serviceArea, selectedDetailers);\n      } else {\n        await createTeam(organizationId, name, description || null, serviceArea, selectedDetailers);\n      }\n      onSaved();\n      onClose();\n    } catch (err: any) {\n      setError(err.message || 'Failed to save team');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n      <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm\" onClick={onClose} />\n      <div className=\"relative z-10 w-full max-w-2xl mx-4 bg-[#0A1A2F] border border-white/5 rounded-xl shadow-xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <div className=\"p-6 border-b border-white/5\">\n          <div className=\"flex justify-between items-center\">\n            <h2 className=\"text-2xl font-bold text-white\">{team ? 'Edit Team' : 'Create Team'}</h2>\n            <button\n              onClick={onClose}\n              className=\"text-[#C6CFD9] hover:text-white transition-colors\"\n            >\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"flex-1 overflow-y-auto p-6\">\n          {error && (\n            <div className=\"mb-4 p-3 bg-red-500/20 border border-red-500/40 rounded-lg text-red-400 text-sm\">\n              {error}\n            </div>\n          )}\n\n          <div className=\"space-y-4\">\n            <div>\n              <label htmlFor=\"name\" className=\"block text-sm font-medium text-white mb-2\">\n                Team Name *\n              </label>\n              <input\n                type=\"text\"\n                id=\"name\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                required\n                className=\"w-full px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white placeholder-[#C6CFD9] focus:outline-none focus:border-[#32CE7A]/40\"\n              />\n            </div>\n\n            <div>\n              <label htmlFor=\"description\" className=\"block text-sm font-medium text-white mb-2\">\n                Description\n              </label>\n              <textarea\n                id=\"description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                rows={3}\n                className=\"w-full px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white placeholder-[#C6CFD9] focus:outline-none focus:border-[#32CE7A]/40\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-white mb-2\">Team Members</label>\n              <div className=\"space-y-2 max-h-48 overflow-y-auto\">\n                {availableDetailers.map((detailer) => (\n                  <label\n                    key={detailer.id}\n                    className=\"flex items-center p-3 bg-[#050B12] border border-white/5 rounded-lg hover:border-[#32CE7A]/40 cursor-pointer\"\n                  >\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedDetailers.includes(detailer.id)}\n                      onChange={(e) => {\n                        if (e.target.checked) {\n                          setSelectedDetailers([...selectedDetailers, detailer.id]);\n                        } else {\n                          setSelectedDetailers(selectedDetailers.filter((id) => id !== detailer.id));\n                        }\n                      }}\n                      className=\"mr-3 w-4 h-4 text-[#32CE7A] bg-[#050B12] border-white/5 rounded focus:ring-[#32CE7A]\"\n                    />\n                    <span className=\"text-white\">{detailer.full_name}</span>\n                  </label>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-6 flex justify-end gap-3\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 bg-[#050B12] border border-white/5 rounded-lg text-white hover:border-white/10 transition-colors\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={loading || !name}\n              className=\"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {loading ? 'Saving...' : team ? 'Update Team' : 'Create Team'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/teams/actions.ts"],"sourcesContent":["'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { requireDetailer } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canManageTeams } from '@/lib/detailer/permissions';\n\n/**\n * Create a new team\n */\nexport async function createTeam(\n  organizationId: string,\n  name: string,\n  description: string | null,\n  serviceArea: any,\n  detailerIds: string[]\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Check permissions\n  const organization = await getDetailerOrganization();\n  if (!organization || organization.id !== organizationId) {\n    throw new Error('Organization not found');\n  }\n\n  const userRole = await getOrganizationRole(organizationId);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to create teams');\n  }\n\n  // Create team\n  const { data: team, error: teamError } = await supabase\n    .from('teams')\n    .insert({\n      organization_id: organizationId,\n      name,\n      description,\n      service_area: serviceArea,\n      is_active: true,\n    })\n    .select()\n    .single();\n\n  if (teamError || !team) {\n    throw new Error('Failed to create team');\n  }\n\n  // Add team members\n  if (detailerIds.length > 0) {\n    const { error: membersError } = await supabase\n      .from('team_members')\n      .insert(\n        detailerIds.map((detailerId) => ({\n          team_id: team.id,\n          detailer_id: detailerId,\n        }))\n      );\n\n    if (membersError) {\n      console.error('Failed to add team members:', membersError);\n      // Don't throw - team was created\n    }\n  }\n\n  return team;\n}\n\n/**\n * Update a team\n */\nexport async function updateTeam(\n  teamId: string,\n  name: string,\n  description: string | null,\n  serviceArea: any,\n  detailerIds: string[]\n) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Get team to verify organization\n  const { data: team } = await supabase\n    .from('teams')\n    .select('organization_id')\n    .eq('id', teamId)\n    .single();\n\n  if (!team) {\n    throw new Error('Team not found');\n  }\n\n  // Check permissions\n  const userRole = await getOrganizationRole(team.organization_id);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to update teams');\n  }\n\n  // Update team\n  const { error: updateError } = await supabase\n    .from('teams')\n    .update({\n      name,\n      description,\n      service_area: serviceArea,\n    })\n    .eq('id', teamId);\n\n  if (updateError) {\n    throw new Error('Failed to update team');\n  }\n\n  // Update team members\n  // Remove all existing members\n  await supabase.from('team_members').delete().eq('team_id', teamId);\n\n  // Add new members\n  if (detailerIds.length > 0) {\n    const { error: membersError } = await supabase\n      .from('team_members')\n      .insert(\n        detailerIds.map((detailerId) => ({\n          team_id: teamId,\n          detailer_id: detailerId,\n        }))\n      );\n\n    if (membersError) {\n      console.error('Failed to update team members:', membersError);\n    }\n  }\n\n  return { success: true };\n}\n\n/**\n * Delete a team (soft delete)\n */\nexport async function deleteTeam(teamId: string) {\n  const supabase = await createClient();\n  await requireDetailer();\n\n  // Get team to verify organization\n  const { data: team } = await supabase\n    .from('teams')\n    .select('organization_id')\n    .eq('id', teamId)\n    .single();\n\n  if (!team) {\n    throw new Error('Team not found');\n  }\n\n  // Check permissions\n  const userRole = await getOrganizationRole(team.organization_id);\n  if (!canManageTeams(userRole)) {\n    throw new Error('You do not have permission to delete teams');\n  }\n\n  // Soft delete\n  const { error } = await supabase\n    .from('teams')\n    .update({ is_active: false })\n    .eq('id', teamId);\n\n  if (error) {\n    throw new Error('Failed to delete team');\n  }\n\n  return { success: true };\n}\n\n"],"names":[],"mappings":";;;;;;;IA0IsB,aAAA,WAAA,GAAA,IAAA,iRAAA,EAAA,8CAAA,sQAAA,EAAA,KAAA,GAAA,4QAAA,EAAA"}},
    {"offset": {"line": 374, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/teams/TeamsPageClient.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport TeamForm from '@/components/detailer/TeamForm';\nimport { deleteTeam } from './actions';\n\ninterface Team {\n  id: string;\n  name: string;\n  description: string | null;\n  service_area: any;\n  is_active: boolean;\n  created_at: string;\n  team_members?: Array<{\n    id: string;\n    detailer: {\n      id: string;\n      full_name: string;\n      profile?: {\n        email: string;\n      };\n    };\n  }>;\n}\n\ninterface TeamsPageClientProps {\n  initialTeams: Team[];\n  organizationId: string;\n  canManageTeams: boolean;\n}\n\nexport default function TeamsPageClient({ initialTeams, organizationId, canManageTeams }: TeamsPageClientProps) {\n  const [teams, setTeams] = useState<Team[]>(initialTeams);\n  const [loading, setLoading] = useState(false);\n  const [formOpen, setFormOpen] = useState(false);\n  const [editingTeam, setEditingTeam] = useState<Team | null>(null);\n  const supabase = createClient();\n  const router = useRouter();\n\n  const handleCreate = () => {\n    setEditingTeam(null);\n    setFormOpen(true);\n  };\n\n  const handleEdit = (team: Team) => {\n    setEditingTeam(team);\n    setFormOpen(true);\n  };\n\n  const handleDelete = async (teamId: string) => {\n    if (!confirm('Are you sure you want to delete this team?')) return;\n    try {\n      await deleteTeam(teamId);\n      router.refresh();\n    } catch (error: any) {\n      alert(error.message || 'Failed to delete team');\n    }\n  };\n\n  const handleSaved = () => {\n    router.refresh();\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Teams List */}\n      <div className=\"bg-[#0A1A2F] border border-white/5 rounded-xl p-6\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <h2 className=\"text-xl font-semibold text-white\">All Teams</h2>\n          {canManageTeams && (\n            <button\n              className=\"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors\"\n              onClick={handleCreate}\n            >\n              + Create Team\n            </button>\n          )}\n        </div>\n\n        {teams.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-[#C6CFD9] mb-4\">No teams created yet</p>\n            {canManageTeams && (\n              <button\n                className=\"px-4 py-2 bg-[#32CE7A] hover:bg-[#2AB869] text-white font-semibold rounded-lg transition-colors\"\n                onClick={handleCreate}\n              >\n                Create Your First Team\n              </button>\n            )}\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {teams.map((team) => (\n              <div\n                key={team.id}\n                className=\"bg-[#050B12] border border-white/5 rounded-lg p-6 hover:border-[#32CE7A]/40 transition-colors\"\n              >\n                <div className=\"flex justify-between items-start mb-2\">\n                  <Link href={`/detailer/teams/${team.id}`} className=\"flex-1\">\n                    <h3 className=\"text-lg font-semibold text-white mb-2\">{team.name}</h3>\n                  </Link>\n                  {canManageTeams && (\n                    <div className=\"flex gap-2\">\n                      <button\n                        onClick={() => handleEdit(team)}\n                        className=\"text-[#32CE7A] hover:text-[#6FF0C4] text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => handleDelete(team.id)}\n                        className=\"text-red-400 hover:text-red-300 text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </div>\n                  )}\n                </div>\n                {team.description && (\n                  <p className=\"text-sm text-[#C6CFD9] mb-4\">{team.description}</p>\n                )}\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-[#C6CFD9]\">\n                    {team.team_members?.length || 0} member{team.team_members?.length !== 1 ? 's' : ''}\n                  </span>\n                  <Link\n                    href={`/detailer/teams/${team.id}`}\n                    className=\"text-[#32CE7A] hover:text-[#6FF0C4]\"\n                  >\n                    View Details â†’\n                  </Link>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Info Box */}\n      <div className=\"bg-[#0A1A2F] border border-white/5 rounded-xl p-6\">\n        <h3 className=\"text-lg font-semibold text-white mb-2\">About Teams</h3>\n        <p className=\"text-[#C6CFD9] text-sm\">\n          Teams allow you to organize detailers into groups. Each team can have its own service area\n          and be assigned to specific jobs. This helps with routing and scheduling.\n        </p>\n      </div>\n\n      <TeamForm\n        isOpen={formOpen}\n        onClose={() => {\n          setFormOpen(false);\n          setEditingTeam(null);\n        }}\n        organizationId={organizationId}\n        team={editingTeam}\n        onSaved={handleSaved}\n      />\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;AAkCe,SAAS,gBAAgB,EAAE,YAAY,EAAE,cAAc,EAAE,cAAc,EAAwB;IAC5G,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,mPAAQ,EAAS;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,mPAAQ,EAAC;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,mPAAQ,EAAC;IACzC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,mPAAQ,EAAc;IAC5D,MAAM,WAAW,IAAA,2KAAY;IAC7B,MAAM,SAAS,IAAA,iLAAS;IAExB,MAAM,eAAe;QACnB,eAAe;QACf,YAAY;IACd;IAEA,MAAM,aAAa,CAAC;QAClB,eAAe;QACf,YAAY;IACd;IAEA,MAAM,eAAe,OAAO;QAC1B,IAAI,CAAC,QAAQ,+CAA+C;QAC5D,IAAI;YACF,MAAM,IAAA,gNAAU,EAAC;YACjB,OAAO,OAAO;QAChB,EAAE,OAAO,OAAY;YACnB,MAAM,MAAM,OAAO,IAAI;QACzB;IACF;IAEA,MAAM,cAAc;QAClB,OAAO,OAAO;IAChB;IAEA,qBACE,gRAAC;QAAI,WAAU;;0BAEb,gRAAC;gBAAI,WAAU;;kCACb,gRAAC;wBAAI,WAAU;;0CACb,gRAAC;gCAAG,WAAU;0CAAmC;;;;;;4BAChD,gCACC,gRAAC;gCACC,WAAU;gCACV,SAAS;0CACV;;;;;;;;;;;;oBAMJ,MAAM,MAAM,KAAK,kBAChB,gRAAC;wBAAI,WAAU;;0CACb,gRAAC;gCAAE,WAAU;0CAAsB;;;;;;4BAClC,gCACC,gRAAC;gCACC,WAAU;gCACV,SAAS;0CACV;;;;;;;;;;;6CAML,gRAAC;wBAAI,WAAU;kCACZ,MAAM,GAAG,CAAC,CAAC,qBACV,gRAAC;gCAEC,WAAU;;kDAEV,gRAAC;wCAAI,WAAU;;0DACb,gRAAC,yMAAI;gDAAC,MAAM,CAAC,gBAAgB,EAAE,KAAK,EAAE,EAAE;gDAAE,WAAU;0DAClD,cAAA,gRAAC;oDAAG,WAAU;8DAAyC,KAAK,IAAI;;;;;;;;;;;4CAEjE,gCACC,gRAAC;gDAAI,WAAU;;kEACb,gRAAC;wDACC,SAAS,IAAM,WAAW;wDAC1B,WAAU;kEACX;;;;;;kEAGD,gRAAC;wDACC,SAAS,IAAM,aAAa,KAAK,EAAE;wDACnC,WAAU;kEACX;;;;;;;;;;;;;;;;;;oCAMN,KAAK,WAAW,kBACf,gRAAC;wCAAE,WAAU;kDAA+B,KAAK,WAAW;;;;;;kDAE9D,gRAAC;wCAAI,WAAU;;0DACb,gRAAC;gDAAK,WAAU;;oDACb,KAAK,YAAY,EAAE,UAAU;oDAAE;oDAAQ,KAAK,YAAY,EAAE,WAAW,IAAI,MAAM;;;;;;;0DAElF,gRAAC,yMAAI;gDACH,MAAM,CAAC,gBAAgB,EAAE,KAAK,EAAE,EAAE;gDAClC,WAAU;0DACX;;;;;;;;;;;;;+BAlCE,KAAK,EAAE;;;;;;;;;;;;;;;;0BA6CtB,gRAAC;gBAAI,WAAU;;kCACb,gRAAC;wBAAG,WAAU;kCAAwC;;;;;;kCACtD,gRAAC;wBAAE,WAAU;kCAAyB;;;;;;;;;;;;0BAMxC,gRAAC,gLAAQ;gBACP,QAAQ;gBACR,SAAS;oBACP,YAAY;oBACZ,eAAe;gBACjB;gBACA,gBAAgB;gBAChB,MAAM;gBACN,SAAS;;;;;;;;;;;;AAIjB"}},
    {"offset": {"line": 639, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0]}}]
}
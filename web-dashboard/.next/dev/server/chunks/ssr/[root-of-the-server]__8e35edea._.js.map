{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/bookings/%5Bid%5D/BookingDetailClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/cleanswift/web-dashboard/app/detailer/bookings/[id]/BookingDetailClient.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/cleanswift/web-dashboard/app/detailer/bookings/[id]/BookingDetailClient.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,0SAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA+U,GAC5W,6GACA","ignoreList":[0]}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/bookings/%5Bid%5D/BookingDetailClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/cleanswift/web-dashboard/app/detailer/bookings/[id]/BookingDetailClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/cleanswift/web-dashboard/app/detailer/bookings/[id]/BookingDetailClient.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,0SAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA2T,GACxV,yFACA","ignoreList":[0]}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/bookings/%5Bid%5D/page.tsx"],"sourcesContent":["import { requireDetailer, getDetailerMode } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canAssignJobs } from '@/lib/detailer/permissions';\nimport { createClient, createServiceClient } from '@/lib/supabase/server';\nimport Link from 'next/link';\nimport { notFound } from 'next/navigation';\nimport BookingDetailClient from './BookingDetailClient';\n\nexport default async function BookingDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  const { id } = await params;\n  const profile = await requireDetailer();\n  const supabase = await createClient();\n  const mode = await getDetailerMode();\n  const organization = mode === 'organization' ? await getDetailerOrganization() : null;\n  const orgRole = organization ? await getOrganizationRole(organization.id) : null;\n\n  // Get detailer record\n  const { data: detailerData, error: detailerError } = await supabase.rpc('get_detailer_by_profile', {\n    p_profile_id: null,\n  });\n\n  if (detailerError) {\n    console.error('Error getting detailer:', detailerError);\n  }\n\n  // First, fetch the booking to check if it exists (using regular client for RLS)\n  const { data: bookingCheck, error: bookingCheckError } = await supabase\n    .from('bookings')\n    .select('id, detailer_id, organization_id, status')\n    .eq('id', id)\n    .single();\n\n  if (bookingCheckError || !bookingCheck) {\n    notFound();\n  }\n\n  // Apply access control\n  let hasAccess = false;\n\n  if (mode === 'organization' && organization && orgRole && canAssignJobs(orgRole)) {\n    // Org managers/dispatchers/owners can see any org booking\n    hasAccess = bookingCheck.organization_id === organization.id;\n  } else if (detailerData?.id) {\n    // Solo or detailer in org: only see own bookings (including offered ones)\n    hasAccess = bookingCheck.detailer_id === detailerData.id;\n  } else {\n    // Fallback: check if booking is assigned to current user's detailer record\n    const { data: detailerFallback } = await supabase\n      .from('detailers')\n      .select('id')\n      .eq('profile_id', profile.id)\n      .single();\n    \n    hasAccess = detailerFallback?.id === bookingCheck.detailer_id;\n  }\n\n  if (!hasAccess) {\n    notFound();\n  }\n\n  // Use service client to fetch full booking data with related tables\n  // This bypasses RLS since we've already verified access above\n  const serviceClient = createServiceClient();\n  \n  const { data: booking, error } = await serviceClient\n    .from('bookings')\n    .select(\n      `\n      *,\n      service:service_id (\n        id,\n        name,\n        price,\n        duration_minutes,\n        description\n      ),\n      car:car_id (\n        id,\n        make,\n        model,\n        year,\n        license_plate\n      ),\n      user:user_id (\n        id,\n        full_name,\n        phone,\n        email\n      ),\n      detailer:detailers (\n        id,\n        full_name\n      ),\n      team:teams (\n        id,\n        name\n      )\n    `\n    )\n    .eq('id', id)\n    .single();\n\n  if (error || !booking) {\n    console.error('Booking query error:', error);\n    notFound();\n  }\n\n  // Get booking timeline\n  const { data: timeline } = await supabase\n    .from('booking_timeline')\n    .select('*')\n    .eq('booking_id', id)\n    .order('changed_at', { ascending: true });\n\n  // Get booking notes\n  const { data: notes } = await supabase\n    .from('booking_notes')\n    .select('*')\n    .eq('booking_id', id)\n    .order('created_at', { ascending: false });\n\n  // Get job photos\n  const { data: photos } = await supabase\n    .from('job_photos')\n    .select('*')\n    .eq('booking_id', id)\n    .order('uploaded_at', { ascending: false });\n\n  const canUpdateStatus =\n    booking.status === 'accepted' || booking.status === 'in_progress' || booking.status === 'completed';\n  const canReassign = mode === 'organization' && organization && orgRole && canAssignJobs(orgRole);\n\n  return (\n    <div className=\"min-h-screen bg-[#050B12] text-white\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <Link\n          href=\"/detailer/bookings\"\n          className=\"text-[#6FF0C4] hover:text-[#32CE7A] mb-6 inline-block\"\n        >\n          ‚Üê Back to Bookings\n        </Link>\n\n        <BookingDetailClient\n          booking={booking}\n          timeline={timeline || []}\n          notes={notes || []}\n          photos={photos || []}\n          canUpdateStatus={canUpdateStatus}\n          canReassign={canReassign}\n          organizationId={organization?.id}\n        />\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}
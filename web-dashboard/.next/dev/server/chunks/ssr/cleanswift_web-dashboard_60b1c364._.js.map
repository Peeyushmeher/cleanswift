{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/lib/detailer/permissions.ts"],"sourcesContent":["/**\n * Permission utilities for role-based access control\n * Defines what each role can do in the organization\n */\n\nexport enum OrganizationRole {\n  Owner = 'owner',\n  Manager = 'manager',\n  Dispatcher = 'dispatcher',\n  Detailer = 'detailer',\n}\n\nexport type OrganizationRoleType = 'owner' | 'manager' | 'dispatcher' | 'detailer';\n\n/**\n * Check if a role can assign jobs\n */\nexport function canAssignJobs(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can manage teams\n */\nexport function canManageTeams(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage members\n */\nexport function canManageMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view organization earnings\n */\nexport function canViewOrgEarnings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage organization settings\n */\nexport function canManageOrgSettings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can change member roles\n */\nexport function canChangeMemberRoles(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can remove members\n */\nexport function canRemoveMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view all organization bookings\n */\nexport function canViewAllOrgBookings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can update booking status\n */\nexport function canUpdateBookingStatus(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can create payout batches\n */\nexport function canCreatePayoutBatches(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Get all permissions for a role\n */\nexport function getRolePermissions(role: OrganizationRoleType | null) {\n  return {\n    canAssignJobs: canAssignJobs(role),\n    canManageTeams: canManageTeams(role),\n    canManageMembers: canManageMembers(role),\n    canViewOrgEarnings: canViewOrgEarnings(role),\n    canManageOrgSettings: canManageOrgSettings(role),\n    canChangeMemberRoles: canChangeMemberRoles(role),\n    canRemoveMembers: canRemoveMembers(role),\n    canViewAllOrgBookings: canViewAllOrgBookings(role),\n    canUpdateBookingStatus: canUpdateBookingStatus(role),\n    canCreatePayoutBatches: canCreatePayoutBatches(role),\n  };\n}\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;;;;;;;;;;;;;AAEM,IAAA,AAAK,0CAAA;;;;;WAAA;;AAYL,SAAS,cAAc,IAAiC;IAC7D,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC,sBAAqC;AACjF;AAKO,SAAS,eAAe,IAAiC;IAC9D,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,iBAAiB,IAAiC;IAChE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,mBAAmB,IAAiC;IAClE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,qBAAqB,IAAiC;IACpE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;AACT;AAKO,SAAS,qBAAqB,IAAiC;IACpE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;AACT;AAKO,SAAS,iBAAiB,IAAiC;IAChE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,sBAAsB,IAAiC;IACrE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC,sBAAqC;AACjF;AAKO,SAAS,uBAAuB,IAAiC;IACtE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC,sBAAqC;AACjF;AAKO,SAAS,uBAAuB,IAAiC;IACtE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,mBAAmB,IAAiC;IAClE,OAAO;QACL,eAAe,cAAc;QAC7B,gBAAgB,eAAe;QAC/B,kBAAkB,iBAAiB;QACnC,oBAAoB,mBAAmB;QACvC,sBAAsB,qBAAqB;QAC3C,sBAAsB,qBAAqB;QAC3C,kBAAkB,iBAAiB;QACnC,uBAAuB,sBAAsB;QAC7C,wBAAwB,uBAAuB;QAC/C,wBAAwB,uBAAuB;IACjD;AACF"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/bookings/actions.ts"],"sourcesContent":["'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { requireDetailer, getDetailerMode } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canAssignJobs } from '@/lib/detailer/permissions';\n\n/**\n * Assign a job to a detailer\n */\nexport async function assignJobToDetailer(bookingId: string, detailerId: string) {\n  const supabase = await createClient();\n  const profile = await requireDetailer();\n\n  // Get booking\n  const { data: booking, error: bookingError } = await supabase\n    .from('bookings')\n    .select('id, organization_id, detailer_id, status')\n    .eq('id', bookingId)\n    .single();\n\n  if (bookingError || !booking) {\n    throw new Error('Booking not found');\n  }\n\n  // Check permissions\n  if (booking.organization_id) {\n    const mode = await getDetailerMode();\n    if (mode === 'organization') {\n      const organization = await getDetailerOrganization();\n      if (organization) {\n        const role = await getOrganizationRole(organization.id);\n        if (!canAssignJobs(role)) {\n          throw new Error('You do not have permission to assign jobs');\n        }\n      }\n    } else {\n      // Solo detailer can only assign to themselves\n      const { data: detailerData } = await supabase.rpc('get_detailer_by_profile', {\n        p_profile_id: null,\n      });\n      if (detailerId !== detailerData?.id) {\n        throw new Error('Solo detailers can only be assigned to themselves');\n      }\n    }\n  } else {\n    // Solo booking - detailer can only assign to themselves\n    const { data: detailerData } = await supabase.rpc('get_detailer_by_profile', {\n      p_profile_id: null,\n    });\n    if (detailerId !== detailerData?.id) {\n      throw new Error('You can only assign jobs to yourself');\n    }\n  }\n\n  // Verify detailer exists and is in the same organization\n  const { data: detailer } = await supabase\n    .from('detailers')\n    .select('id, organization_id')\n    .eq('id', detailerId)\n    .single();\n\n  if (!detailer) {\n    throw new Error('Detailer not found');\n  }\n\n  if (booking.organization_id && detailer.organization_id !== booking.organization_id) {\n    throw new Error('Detailer is not in the same organization');\n  }\n\n  // Update booking\n  const { error: updateError } = await supabase\n    .from('bookings')\n    .update({\n      detailer_id: detailerId,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('id', bookingId);\n\n  if (updateError) {\n    throw new Error('Failed to assign job');\n  }\n\n  // Create timeline entry\n  const { error: timelineError } = await supabase\n    .from('booking_timeline')\n    .insert({\n      booking_id: bookingId,\n      status_from: booking.status,\n      status_to: booking.status, // Status doesn't change, just assignment\n      changed_by: profile.id,\n      notes: `Job assigned to detailer`,\n    });\n\n  if (timelineError) {\n    console.error('Failed to create timeline entry:', timelineError);\n    // Don't throw - assignment succeeded\n  }\n\n  return { success: true };\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;;;;;AAKO,eAAe,oBAAoB,SAAiB,EAAE,UAAkB;IAC7E,MAAM,WAAW,MAAM,IAAA,2KAAY;IACnC,MAAM,UAAU,MAAM,IAAA,gKAAe;IAErC,cAAc;IACd,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,YACL,MAAM,CAAC,4CACP,EAAE,CAAC,MAAM,WACT,MAAM;IAET,IAAI,gBAAgB,CAAC,SAAS;QAC5B,MAAM,IAAI,MAAM;IAClB;IAEA,oBAAoB;IACpB,IAAI,QAAQ,eAAe,EAAE;QAC3B,MAAM,OAAO,MAAM,IAAA,gKAAe;QAClC,IAAI,SAAS,gBAAgB;YAC3B,MAAM,eAAe,MAAM,IAAA,iMAAuB;YAClD,IAAI,cAAc;gBAChB,MAAM,OAAO,MAAM,IAAA,6LAAmB,EAAC,aAAa,EAAE;gBACtD,IAAI,CAAC,IAAA,iLAAa,EAAC,OAAO;oBACxB,MAAM,IAAI,MAAM;gBAClB;YACF;QACF,OAAO;YACL,8CAA8C;YAC9C,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,2BAA2B;gBAC3E,cAAc;YAChB;YACA,IAAI,eAAe,cAAc,IAAI;gBACnC,MAAM,IAAI,MAAM;YAClB;QACF;IACF,OAAO;QACL,wDAAwD;QACxD,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,2BAA2B;YAC3E,cAAc;QAChB;QACA,IAAI,eAAe,cAAc,IAAI;YACnC,MAAM,IAAI,MAAM;QAClB;IACF;IAEA,yDAAyD;IACzD,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,aACL,MAAM,CAAC,uBACP,EAAE,CAAC,MAAM,YACT,MAAM;IAET,IAAI,CAAC,UAAU;QACb,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,QAAQ,eAAe,IAAI,SAAS,eAAe,KAAK,QAAQ,eAAe,EAAE;QACnF,MAAM,IAAI,MAAM;IAClB;IAEA,iBAAiB;IACjB,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,YACL,MAAM,CAAC;QACN,aAAa;QACb,YAAY,IAAI,OAAO,WAAW;IACpC,GACC,EAAE,CAAC,MAAM;IAEZ,IAAI,aAAa;QACf,MAAM,IAAI,MAAM;IAClB;IAEA,wBAAwB;IACxB,MAAM,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACpC,IAAI,CAAC,oBACL,MAAM,CAAC;QACN,YAAY;QACZ,aAAa,QAAQ,MAAM;QAC3B,WAAW,QAAQ,MAAM;QACzB,YAAY,QAAQ,EAAE;QACtB,OAAO,CAAC,wBAAwB,CAAC;IACnC;IAEF,IAAI,eAAe;QACjB,QAAQ,KAAK,CAAC,oCAAoC;IAClD,qCAAqC;IACvC;IAEA,OAAO;QAAE,SAAS;IAAK;AACzB;;;IA1FsB;;AAAA,iRAAA"}},
    {"offset": {"line": 191, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/.next-internal/server/app/detailer/bookings/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {assignJobToDetailer as '60a99119db695fbd12e3fb361d3ea7fb0228ee8bda'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n"],"names":["registerServerReference"],"mappings":"AAAA,oDAAoD;;;+BAC3CA,2BAAAA;;;eAAAA,QAAAA,uBAAuB;;;wBAAQ","ignoreList":[0]}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"AAAA,+EAA+E;AAC/E,yEAAyE;AACzE,iEAAiE;;;;+BACjDA,4BAAAA;;;eAAAA;;;AAAT,SAASA,yBAAyBC,OAAc;IACrD,IAAK,IAAIC,IAAI,GAAGA,IAAID,QAAQE,MAAM,EAAED,IAAK;QACvC,MAAME,SAASH,OAAO,CAACC,EAAE;QACzB,IAAI,OAAOE,WAAW,YAAY;YAChC,MAAM,OAAA,cAEL,CAFK,IAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,OAAO,uEAAuE,CAAC,GADhJ,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;IACF;AACF","ignoreList":[0]}}]
}
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js';\nimport { cookies } from 'next/headers';\n\nexport async function createClient() {\n  const cookieStore = await cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            );\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  );\n}\n\n/**\n * Creates a Supabase client with service role privileges.\n * This bypasses RLS and should only be used in trusted server-side code\n * for operations that require elevated access (e.g., fetching related data\n * across tables where RLS would block access).\n * \n * IMPORTANT: Never expose this client to client-side code.\n */\nexport function createServiceClient() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error('Missing Supabase service role credentials');\n  }\n\n  return createSupabaseClient(supabaseUrl, serviceRoleKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  });\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4KAAO;IAEjC,OAAO,IAAA,iOAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAUO,SAAS;IACd,MAAM;IACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;IAE5D,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,yOAAoB,EAAC,aAAa,gBAAgB;QACvD,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/lib/detailer/mode-detection.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server';\n\nexport type DetailerMode = 'solo' | 'organization';\n\n/**\n * Get the detailer mode (solo or organization) for a user\n * @param profileId - Optional profile ID, defaults to current authenticated user\n * @returns 'solo' if detailer has no organization, 'organization' if they belong to one\n */\nexport async function getDetailerMode(profileId?: string): Promise<DetailerMode> {\n  const supabase = await createClient();\n  \n  // Get current user if profileId not provided\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user && !profileId) {\n    throw new Error('Not authenticated');\n  }\n\n  const targetProfileId = profileId || user!.id;\n\n  // Check if detailer has an organization\n  const { data: detailer } = await supabase\n    .from('detailers')\n    .select('organization_id')\n    .eq('profile_id', targetProfileId)\n    .single();\n\n  if (!detailer) {\n    // No detailer record, assume solo\n    return 'solo';\n  }\n\n  // If organization_id is set, they're in organization mode\n  if (detailer.organization_id) {\n    return 'organization';\n  }\n\n  return 'solo';\n}\n\n/**\n * Get organization details for a detailer\n * @param profileId - Optional profile ID, defaults to current authenticated user\n * @returns Organization object or null if solo\n */\nexport async function getDetailerOrganization(profileId?: string) {\n  const supabase = await createClient();\n  \n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user && !profileId) {\n    throw new Error('Not authenticated');\n  }\n\n  const targetProfileId = profileId || user!.id;\n\n  // Use the RPC function to get organization\n  const { data, error } = await supabase.rpc('get_user_organization', {\n    p_profile_id: targetProfileId,\n  });\n\n  if (error) {\n    console.error('Error getting organization:', error);\n    return null;\n  }\n\n  return data && data.length > 0 ? data[0] : null;\n}\n\n/**\n * Get the user's role in their organization\n * @param organizationId - Organization ID\n * @param profileId - Optional profile ID, defaults to current authenticated user\n * @returns Role enum or null if not a member\n */\nexport async function getOrganizationRole(\n  organizationId: string,\n  profileId?: string\n) {\n  const supabase = await createClient();\n  \n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user && !profileId) {\n    throw new Error('Not authenticated');\n  }\n\n  const targetProfileId = profileId || user!.id;\n\n  const { data, error } = await supabase.rpc('get_user_role_in_organization', {\n    p_profile_id: targetProfileId,\n    p_organization_id: organizationId,\n  });\n\n  if (error) {\n    console.error('Error getting organization role:', error);\n    return null;\n  }\n\n  return data;\n}\n\n"],"names":[],"mappings":";;;;;;;;AAAA;;AASO,eAAe,gBAAgB,SAAkB;IACtD,MAAM,WAAW,MAAM,IAAA,2KAAY;IAEnC,6CAA6C;IAC7C,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,QAAQ,CAAC,WAAW;QACvB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,kBAAkB,aAAa,KAAM,EAAE;IAE7C,wCAAwC;IACxC,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,aACL,MAAM,CAAC,mBACP,EAAE,CAAC,cAAc,iBACjB,MAAM;IAET,IAAI,CAAC,UAAU;QACb,kCAAkC;QAClC,OAAO;IACT;IAEA,0DAA0D;IAC1D,IAAI,SAAS,eAAe,EAAE;QAC5B,OAAO;IACT;IAEA,OAAO;AACT;AAOO,eAAe,wBAAwB,SAAkB;IAC9D,MAAM,WAAW,MAAM,IAAA,2KAAY;IAEnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,QAAQ,CAAC,WAAW;QACvB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,kBAAkB,aAAa,KAAM,EAAE;IAE7C,2CAA2C;IAC3C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,yBAAyB;QAClE,cAAc;IAChB;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACT;IAEA,OAAO,QAAQ,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,EAAE,GAAG;AAC7C;AAQO,eAAe,oBACpB,cAAsB,EACtB,SAAkB;IAElB,MAAM,WAAW,MAAM,IAAA,2KAAY;IAEnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,QAAQ,CAAC,WAAW;QACvB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,kBAAkB,aAAa,KAAM,EAAE;IAE7C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,iCAAiC;QAC1E,cAAc;QACd,mBAAmB;IACrB;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/lib/auth.ts"],"sourcesContent":["import { createClient } from './supabase/server';\nimport { redirect } from 'next/navigation';\nimport { getDetailerMode as getMode } from './detailer/mode-detection';\n\nexport interface UserProfile {\n  id: string;\n  full_name: string;\n  email: string;\n  phone: string;\n  role: 'user' | 'detailer' | 'admin';\n  avatar_url: string | null;\n}\n\n/**\n * Get the current user's session and profile\n */\nexport async function getSession() {\n  const supabase = await createClient();\n  const {\n    data: { session },\n  } = await supabase.auth.getSession();\n  return session;\n}\n\n/**\n * Get the current user's profile with role\n */\nexport async function getUserProfile(): Promise<UserProfile | null> {\n  const supabase = await createClient();\n  const session = await getSession();\n\n  if (!session?.user) {\n    return null;\n  }\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .select('id, full_name, email, phone, role, avatar_url')\n    .eq('id', session.user.id)\n    .single();\n\n  if (error) {\n    console.error('Profile query error in getUserProfile:', error.message, error.code, error.details);\n    return null;\n  }\n  \n  if (!data) {\n    console.error('No profile found for user:', session.user.id);\n    return null;\n  }\n\n  return data as UserProfile;\n}\n\n/**\n * Check if user is authenticated, redirect to login if not\n */\nexport async function requireAuth() {\n  const session = await getSession();\n  if (!session) {\n    redirect('/auth/login');\n  }\n  return session;\n}\n\n/**\n * Check if user has detailer role, redirect if not\n */\nexport async function requireDetailer() {\n  const profile = await getUserProfile();\n  if (!profile || (profile.role !== 'detailer' && profile.role !== 'admin')) {\n    redirect('/auth/login');\n  }\n  return profile;\n}\n\n/**\n * Check if user has admin role, redirect if not\n */\nexport async function requireAdmin() {\n  const profile = await getUserProfile();\n  if (!profile || profile.role !== 'admin') {\n    redirect('/auth/login');\n  }\n  return profile;\n}\n\n/**\n * Get the detailer mode (solo or organization)\n * @param profileId - Optional profile ID, defaults to current authenticated user\n * @returns 'solo' if detailer has no organization, 'organization' if they belong to one\n */\nexport async function getDetailerMode(profileId?: string) {\n  return getMode(profileId);\n}\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AAAA;AACA;;;;AAcO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,2KAAY;IACnC,MAAM,EACJ,MAAM,EAAE,OAAO,EAAE,EAClB,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAClC,OAAO;AACT;AAKO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,2KAAY;IACnC,MAAM,UAAU,MAAM;IAEtB,IAAI,CAAC,SAAS,MAAM;QAClB,OAAO;IACT;IAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,iDACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;IAET,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,0CAA0C,MAAM,OAAO,EAAE,MAAM,IAAI,EAAE,MAAM,OAAO;QAChG,OAAO;IACT;IAEA,IAAI,CAAC,MAAM;QACT,QAAQ,KAAK,CAAC,8BAA8B,QAAQ,IAAI,CAAC,EAAE;QAC3D,OAAO;IACT;IAEA,OAAO;AACT;AAKO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,IAAI,CAAC,SAAS;QACZ,IAAA,mOAAQ,EAAC;IACX;IACA,OAAO;AACT;AAKO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,IAAI,CAAC,WAAY,QAAQ,IAAI,KAAK,cAAc,QAAQ,IAAI,KAAK,SAAU;QACzE,IAAA,mOAAQ,EAAC;IACX;IACA,OAAO;AACT;AAKO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,SAAS;QACxC,IAAA,mOAAQ,EAAC;IACX;IACA,OAAO;AACT;AAOO,eAAe,gBAAgB,SAAkB;IACtD,OAAO,IAAA,yLAAO,EAAC;AACjB"}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/components/detailer/Sidebar.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/cleanswift/web-dashboard/components/detailer/Sidebar.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/cleanswift/web-dashboard/components/detailer/Sidebar.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,0SAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA4T,GACzV,0FACA","ignoreList":[0]}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/components/detailer/Sidebar.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/cleanswift/web-dashboard/components/detailer/Sidebar.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/cleanswift/web-dashboard/components/detailer/Sidebar.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,0SAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAwS,GACrU,sEACA","ignoreList":[0]}},
    {"offset": {"line": 220, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/components/detailer/Header.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/cleanswift/web-dashboard/components/detailer/Header.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/cleanswift/web-dashboard/components/detailer/Header.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,0SAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA2T,GACxV,yFACA","ignoreList":[0]}},
    {"offset": {"line": 242, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/components/detailer/Header.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/cleanswift/web-dashboard/components/detailer/Header.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/cleanswift/web-dashboard/components/detailer/Header.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,0SAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAuS,GACpU,qEACA","ignoreList":[0]}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/layout.tsx"],"sourcesContent":["import { requireDetailer, getDetailerMode } from '@/lib/auth';\nimport Sidebar from '@/components/detailer/Sidebar';\nimport Header from '@/components/detailer/Header';\n\nexport default async function DetailerLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const profile = await requireDetailer();\n  const mode = await getDetailerMode();\n\n  return (\n    <div className=\"min-h-screen bg-[#050B12] text-white flex\">\n      <Sidebar mode={mode} profile={profile} />\n      <div className=\"flex-1 flex flex-col\">\n        <Header />\n        <main className=\"flex-1 overflow-y-auto\">\n          {children}\n        </main>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAEe,eAAe,eAAe,EAC3C,QAAQ,EAGT;IACC,MAAM,UAAU,MAAM,IAAA,gKAAe;IACrC,MAAM,OAAO,MAAM,IAAA,gKAAe;IAElC,qBACE,gRAAC;QAAI,WAAU;;0BACb,gRAAC,+KAAO;gBAAC,MAAM;gBAAM,SAAS;;;;;;0BAC9B,gRAAC;gBAAI,WAAU;;kCACb,gRAAC,8KAAM;;;;;kCACP,gRAAC;wBAAK,WAAU;kCACb;;;;;;;;;;;;;;;;;;AAKX"}}]
}
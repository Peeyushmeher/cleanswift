{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/lib/detailer/permissions.ts"],"sourcesContent":["/**\n * Permission utilities for role-based access control\n * Defines what each role can do in the organization\n */\n\nexport enum OrganizationRole {\n  Owner = 'owner',\n  Manager = 'manager',\n  Dispatcher = 'dispatcher',\n  Detailer = 'detailer',\n}\n\nexport type OrganizationRoleType = 'owner' | 'manager' | 'dispatcher' | 'detailer';\n\n/**\n * Check if a role can assign jobs\n */\nexport function canAssignJobs(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can manage teams\n */\nexport function canManageTeams(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage members\n */\nexport function canManageMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view organization earnings\n */\nexport function canViewOrgEarnings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can manage organization settings\n */\nexport function canManageOrgSettings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can change member roles\n */\nexport function canChangeMemberRoles(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner;\n}\n\n/**\n * Check if a role can remove members\n */\nexport function canRemoveMembers(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Check if a role can view all organization bookings\n */\nexport function canViewAllOrgBookings(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can update booking status\n */\nexport function canUpdateBookingStatus(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager || role === OrganizationRole.Dispatcher;\n}\n\n/**\n * Check if a role can create payout batches\n */\nexport function canCreatePayoutBatches(role: OrganizationRoleType | null): boolean {\n  if (!role) return false;\n  return role === OrganizationRole.Owner || role === OrganizationRole.Manager;\n}\n\n/**\n * Get all permissions for a role\n */\nexport function getRolePermissions(role: OrganizationRoleType | null) {\n  return {\n    canAssignJobs: canAssignJobs(role),\n    canManageTeams: canManageTeams(role),\n    canManageMembers: canManageMembers(role),\n    canViewOrgEarnings: canViewOrgEarnings(role),\n    canManageOrgSettings: canManageOrgSettings(role),\n    canChangeMemberRoles: canChangeMemberRoles(role),\n    canRemoveMembers: canRemoveMembers(role),\n    canViewAllOrgBookings: canViewAllOrgBookings(role),\n    canUpdateBookingStatus: canUpdateBookingStatus(role),\n    canCreatePayoutBatches: canCreatePayoutBatches(role),\n  };\n}\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;;;;;;;;;;;;;AAEM,IAAA,AAAK,0CAAA;;;;;WAAA;;AAYL,SAAS,cAAc,IAAiC;IAC7D,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC,sBAAqC;AACjF;AAKO,SAAS,eAAe,IAAiC;IAC9D,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,iBAAiB,IAAiC;IAChE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,mBAAmB,IAAiC;IAClE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,qBAAqB,IAAiC;IACpE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;AACT;AAKO,SAAS,qBAAqB,IAAiC;IACpE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;AACT;AAKO,SAAS,iBAAiB,IAAiC;IAChE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,sBAAsB,IAAiC;IACrE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC,sBAAqC;AACjF;AAKO,SAAS,uBAAuB,IAAiC;IACtE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC,sBAAqC;AACjF;AAKO,SAAS,uBAAuB,IAAiC;IACtE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,oBAAmC;AAC5C;AAKO,SAAS,mBAAmB,IAAiC;IAClE,OAAO;QACL,eAAe,cAAc;QAC7B,gBAAgB,eAAe;QAC/B,kBAAkB,iBAAiB;QACnC,oBAAoB,mBAAmB;QACvC,sBAAsB,qBAAqB;QAC3C,sBAAsB,qBAAqB;QAC3C,kBAAkB,iBAAiB;QACnC,uBAAuB,sBAAsB;QAC7C,wBAAwB,uBAAuB;QAC/C,wBAAwB,uBAAuB;IACjD;AACF"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/lib/services/bookings.ts"],"sourcesContent":["'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport type { Booking, BookingStatus } from '@/types/detailer';\n\ntype BookingSelect = Booking & {\n  service?: Booking['service'];\n  car?: Booking['car'];\n  user?: Booking['user'];\n  detailer?: Booking['detailer'];\n  team?: Booking['team'];\n};\n\nconst BOOKING_DETAIL_SELECT = `\n  id,\n  receipt_id,\n  status,\n  payment_status,\n  scheduled_date,\n  scheduled_time_start,\n  scheduled_time_end,\n  scheduled_start,\n  scheduled_end,\n  total_amount,\n  service_price,\n  addons_total,\n  tax_amount,\n  detailer_id,\n  organization_id,\n  team_id,\n  address_line1,\n  city,\n  province,\n  postal_code,\n  latitude,\n  longitude,\n  location_notes,\n  created_at,\n  updated_at,\n  completed_at,\n  service:service_id (id, name, price, duration_minutes),\n  car:car_id (id, make, model, year, license_plate),\n  user:user_id (id, full_name, phone, email),\n  detailer:detailer_id (id, full_name),\n  team:team_id (id, name)\n`;\n\nexport interface GetBookingsFilters {\n  status?: BookingStatus | BookingStatus[];\n  detailerId?: string;\n  organizationId?: string;\n  fromDate?: string;\n  toDate?: string;\n  limit?: number;\n  orderBy?: 'scheduled_date' | 'created_at';\n  ascending?: boolean;\n}\n\nfunction asArray<T>(value?: T | T[]): T[] | undefined {\n  if (value === undefined || value === null) {\n    return undefined;\n  }\n\n  return Array.isArray(value) ? value : [value];\n}\n\nfunction formatError(action: string, message?: string) {\n  return new Error(message ? `Failed to ${action}: ${message}` : `Failed to ${action}`);\n}\n\n// Queries\nexport async function getBookings(filters: GetBookingsFilters = {}) {\n  const supabase = await createClient();\n  const {\n    status,\n    detailerId,\n    organizationId,\n    fromDate,\n    toDate,\n    limit = 200,\n    orderBy = 'scheduled_date',\n    ascending = true,\n  } = filters;\n\n  let query = supabase\n    .from('bookings')\n    .select(BOOKING_DETAIL_SELECT)\n    .order(orderBy, { ascending })\n    .order('scheduled_time_start', { ascending: true, nullsFirst: false })\n    .limit(limit);\n\n  const statusArray = asArray(status);\n  if (statusArray?.length) {\n    query = query.in('status', statusArray);\n  }\n\n  if (detailerId) {\n    query = query.eq('detailer_id', detailerId);\n  }\n\n  if (organizationId) {\n    query = query.eq('organization_id', organizationId);\n  }\n\n  if (fromDate) {\n    query = query.gte('scheduled_date', fromDate);\n  }\n\n  if (toDate) {\n    query = query.lte('scheduled_date', toDate);\n  }\n\n  const { data, error } = await query.returns<BookingSelect[]>();\n\n  if (error) {\n    throw formatError('fetch bookings', error.message);\n  }\n\n  return (data ?? []) as Booking[];\n}\n\nexport async function getBookingById(bookingId: string) {\n  const supabase = await createClient();\n\n  const { data, error } = await supabase\n    .from('bookings')\n    .select(BOOKING_DETAIL_SELECT)\n    .eq('id', bookingId)\n    .single();\n\n  if (error || !data) {\n    throw formatError('fetch booking', error?.message);\n  }\n\n  return data as Booking;\n}\n\n// Commands\nexport async function updateBookingStatus(bookingId: string, newStatus: BookingStatus) {\n  const supabase = await createClient();\n\n  const { data, error } = await supabase.rpc('update_booking_status', {\n    p_booking_id: bookingId,\n    p_new_status: newStatus,\n  });\n\n  if (error || !data) {\n    throw formatError('update booking status', error?.message);\n  }\n\n  return data as Booking;\n}\n\nexport async function assignBookingToDetailer(bookingId: string, detailerId: string) {\n  const supabase = await createClient();\n\n  const { data, error } = await supabase.rpc('assign_detailer_to_booking', {\n    p_booking_id: bookingId,\n    p_detailer_id: detailerId,\n  });\n\n  if (error || !data) {\n    throw formatError('assign booking to detailer', error?.message);\n  }\n\n  return data as Booking;\n}\n\nexport async function acceptBooking(bookingId: string) {\n  const supabase = await createClient();\n\n  const { data, error } = await supabase.rpc('accept_booking', {\n    p_booking_id: bookingId,\n  });\n\n  if (error || !data) {\n    throw formatError('accept booking', error?.message);\n  }\n\n  return data as Booking;\n}\n\nexport async function cancelBooking(bookingId: string) {\n  return updateBookingStatus(bookingId, 'cancelled');\n}\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAEA;;;;AAWA,MAAM,wBAAwB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgC/B,CAAC;AAaD,SAAS,QAAW,KAAe;IACjC,IAAI,UAAU,aAAa,UAAU,MAAM;QACzC,OAAO;IACT;IAEA,OAAO,MAAM,OAAO,CAAC,SAAS,QAAQ;QAAC;KAAM;AAC/C;AAEA,SAAS,YAAY,MAAc,EAAE,OAAgB;IACnD,OAAO,IAAI,MAAM,UAAU,CAAC,UAAU,EAAE,OAAO,EAAE,EAAE,SAAS,GAAG,CAAC,UAAU,EAAE,QAAQ;AACtF;AAGO,eAAe,YAAY,UAA8B,CAAC,CAAC;IAChE,MAAM,WAAW,MAAM,IAAA,2KAAY;IACnC,MAAM,EACJ,MAAM,EACN,UAAU,EACV,cAAc,EACd,QAAQ,EACR,MAAM,EACN,QAAQ,GAAG,EACX,UAAU,gBAAgB,EAC1B,YAAY,IAAI,EACjB,GAAG;IAEJ,IAAI,QAAQ,SACT,IAAI,CAAC,YACL,MAAM,CAAC,uBACP,KAAK,CAAC,SAAS;QAAE;IAAU,GAC3B,KAAK,CAAC,wBAAwB;QAAE,WAAW;QAAM,YAAY;IAAM,GACnE,KAAK,CAAC;IAET,MAAM,cAAc,QAAQ;IAC5B,IAAI,aAAa,QAAQ;QACvB,QAAQ,MAAM,EAAE,CAAC,UAAU;IAC7B;IAEA,IAAI,YAAY;QACd,QAAQ,MAAM,EAAE,CAAC,eAAe;IAClC;IAEA,IAAI,gBAAgB;QAClB,QAAQ,MAAM,EAAE,CAAC,mBAAmB;IACtC;IAEA,IAAI,UAAU;QACZ,QAAQ,MAAM,GAAG,CAAC,kBAAkB;IACtC;IAEA,IAAI,QAAQ;QACV,QAAQ,MAAM,GAAG,CAAC,kBAAkB;IACtC;IAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,MAAM,OAAO;IAE3C,IAAI,OAAO;QACT,MAAM,YAAY,kBAAkB,MAAM,OAAO;IACnD;IAEA,OAAQ,QAAQ,EAAE;AACpB;AAEO,eAAe,eAAe,SAAiB;IACpD,MAAM,WAAW,MAAM,IAAA,2KAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,uBACP,EAAE,CAAC,MAAM,WACT,MAAM;IAET,IAAI,SAAS,CAAC,MAAM;QAClB,MAAM,YAAY,iBAAiB,OAAO;IAC5C;IAEA,OAAO;AACT;AAGO,eAAe,oBAAoB,SAAiB,EAAE,SAAwB;IACnF,MAAM,WAAW,MAAM,IAAA,2KAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,yBAAyB;QAClE,cAAc;QACd,cAAc;IAChB;IAEA,IAAI,SAAS,CAAC,MAAM;QAClB,MAAM,YAAY,yBAAyB,OAAO;IACpD;IAEA,OAAO;AACT;AAEO,eAAe,wBAAwB,SAAiB,EAAE,UAAkB;IACjF,MAAM,WAAW,MAAM,IAAA,2KAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,8BAA8B;QACvE,cAAc;QACd,eAAe;IACjB;IAEA,IAAI,SAAS,CAAC,MAAM;QAClB,MAAM,YAAY,8BAA8B,OAAO;IACzD;IAEA,OAAO;AACT;AAEO,eAAe,cAAc,SAAiB;IACnD,MAAM,WAAW,MAAM,IAAA,2KAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,kBAAkB;QAC3D,cAAc;IAChB;IAEA,IAAI,SAAS,CAAC,MAAM;QAClB,MAAM,YAAY,kBAAkB,OAAO;IAC7C;IAEA,OAAO;AACT;AAEO,eAAe,cAAc,SAAiB;IACnD,OAAO,oBAAoB,WAAW;AACxC;;;IAjHsB;IAkDA;IAiBA;IAeA;IAeA;IAcA;;AA/GA,iRAAA;AAkDA,iRAAA;AAiBA,iRAAA;AAeA,iRAAA;AAeA,iRAAA;AAcA,iRAAA"}},
    {"offset": {"line": 254, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/app/detailer/bookings/actions.ts"],"sourcesContent":["'use server';\n\nimport { requireDetailer, getDetailerMode } from '@/lib/auth';\nimport { getDetailerOrganization, getOrganizationRole } from '@/lib/detailer/mode-detection';\nimport { canAssignJobs } from '@/lib/detailer/permissions';\nimport { assignBookingToDetailer } from '@/lib/services/bookings';\n\n/**\n * Assign a job to a detailer\n */\nexport async function assignJobToDetailer(bookingId: string, detailerId: string) {\n  await requireDetailer();\n\n  const mode = await getDetailerMode();\n  if (mode === 'organization') {\n    const organization = await getDetailerOrganization();\n    if (organization) {\n      const role = await getOrganizationRole(organization.id);\n      if (!canAssignJobs(role)) {\n        throw new Error('You do not have permission to assign jobs');\n      }\n    }\n  }\n\n  await assignBookingToDetailer(bookingId, detailerId);\n\n  return { success: true };\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;;;;;AAKO,eAAe,oBAAoB,SAAiB,EAAE,UAAkB;IAC7E,MAAM,IAAA,gKAAe;IAErB,MAAM,OAAO,MAAM,IAAA,gKAAe;IAClC,IAAI,SAAS,gBAAgB;QAC3B,MAAM,eAAe,MAAM,IAAA,iMAAuB;QAClD,IAAI,cAAc;YAChB,MAAM,OAAO,MAAM,IAAA,6LAAmB,EAAC,aAAa,EAAE;YACtD,IAAI,CAAC,IAAA,iLAAa,EAAC,OAAO;gBACxB,MAAM,IAAI,MAAM;YAClB;QACF;IACF;IAEA,MAAM,IAAA,wLAAuB,EAAC,WAAW;IAEzC,OAAO;QAAE,SAAS;IAAK;AACzB;;;IAjBsB;;AAAA,iRAAA"}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/.next-internal/server/app/detailer/bookings/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {assignJobToDetailer as '60a99119db695fbd12e3fb361d3ea7fb0228ee8bda'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n"],"names":["registerServerReference"],"mappings":"AAAA,oDAAoD;;;+BAC3CA,2BAAAA;;;eAAAA,QAAAA,uBAAuB;;;wBAAQ","ignoreList":[0]}},
    {"offset": {"line": 326, "column": 0}, "map": {"version":3,"sources":["file:///Users/camps/cleanswift/web-dashboard/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"AAAA,+EAA+E;AAC/E,yEAAyE;AACzE,iEAAiE;;;;+BACjDA,4BAAAA;;;eAAAA;;;AAAT,SAASA,yBAAyBC,OAAc;IACrD,IAAK,IAAIC,IAAI,GAAGA,IAAID,QAAQE,MAAM,EAAED,IAAK;QACvC,MAAME,SAASH,OAAO,CAACC,EAAE;QACzB,IAAI,OAAOE,WAAW,YAAY;YAChC,MAAM,OAAA,cAEL,CAFK,IAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,OAAO,uEAAuE,CAAC,GADhJ,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;IACF;AACF","ignoreList":[0]}}]
}